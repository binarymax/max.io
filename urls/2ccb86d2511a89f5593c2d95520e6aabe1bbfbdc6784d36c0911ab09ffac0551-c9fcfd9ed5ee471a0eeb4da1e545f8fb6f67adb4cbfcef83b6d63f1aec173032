{"value":{"status":"fulfilled","value":{"html":"<!DOCTYPE html><html lang=\"en\"><head><style data-hubspot-styled-components=\"\"></style>\n    <meta charset=\"UTF-8\">\n\n    <style>\n        /* Hide undefined elements */\n        box-l:not(:defined),\n        center-l:not(:defined),\n        cluster-l:not(:defined),\n        cover-l:not(:defined),\n        frame-l:not(:defined),\n        grid-l:not(:defined),\n        icon-l:not(:defined),\n        imposter-l:not(:defined),\n        stack-l:not(:defined),\n        switcher-l:not(:defined) {\n            opacity: 0;\n        }\n    </style><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta name=\"base\" content=\"https://bonsai.io\">\n    <base href=\"https://bonsai.io/\">\n\n    \n    <title>Bonsai Blog | Fully Managed Elasticsearch &amp; OpenSearch • How to really do autocomplete</title>\n\n    \n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin=\"\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&amp;display=swap\" rel=\"stylesheet\">\n\n    \n    \n        \n        \n        <link rel=\"icon\" type=\"image/png\" href=\"https://bonsai.io/static-assets/img/bonsai-tree-32x32.png?h=a6frOVXQu0bb3hzKrdrAEz/otDQEaVcIvS25Q+/NQw0=\" integrity=\"sha256-a6frOVXQu0bb3hzKrdrAEz/otDQEaVcIvS25Q+/NQw0=\">\n    \n\n    \n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/bonsai/normalize.css?h=2h2qclC3QR4FMidpLSH+AgICdbVgXtJo5XF0+sI03LQ=\" integrity=\"sha256-2h2qclC3QR4FMidpLSH+AgICdbVgXtJo5XF0+sI03LQ=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/bonsai/settings.css?h=mevoCLaNJZ3Q5GiGci1Tls7s+dYICxtNCH/Q1RPwlk8=\" integrity=\"sha256-mevoCLaNJZ3Q5GiGci1Tls7s+dYICxtNCH/Q1RPwlk8=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/bonsai/typography.css?h=zP0ktfwwQ6zIUBxFu/Y8p5CkN8bHFambBdcyqsmXKHU=\" integrity=\"sha256-zP0ktfwwQ6zIUBxFu/Y8p5CkN8bHFambBdcyqsmXKHU=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/bonsai/utilities.css?h=v8689OSPRdFV81ImOJuRO2I3Q5agcQfDTYag1Cl7GQ4=\" integrity=\"sha256-v8689OSPRdFV81ImOJuRO2I3Q5agcQfDTYag1Cl7GQ4=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Box.css?h=f5HwSWiBGjDdiNPrAc8Sg2WKpMzHTeI5Al5crsdLnNQ=\" integrity=\"sha256-f5HwSWiBGjDdiNPrAc8Sg2WKpMzHTeI5Al5crsdLnNQ=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Center.css?h=igTNkA5+kCizpJa8q2ZW8Pd0Jz/+c8uRn74JP4wp1sw=\" integrity=\"sha256-igTNkA5+kCizpJa8q2ZW8Pd0Jz/+c8uRn74JP4wp1sw=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Cluster.css?h=pMnRadbPNnSmZ5h4Ejkupo1X3Ns4YbePb8KwGveNYAE=\" integrity=\"sha256-pMnRadbPNnSmZ5h4Ejkupo1X3Ns4YbePb8KwGveNYAE=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Cover.css?h=gMjx4VcXs524Uc0nBqV3m0BahHX6fDFOp7FYJlf/jyA=\" integrity=\"sha256-gMjx4VcXs524Uc0nBqV3m0BahHX6fDFOp7FYJlf/jyA=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Frame.css?h=iLw7pulmW41HogdCkoDvHc4DERoq8WJvtcDjo1nDiw4=\" integrity=\"sha256-iLw7pulmW41HogdCkoDvHc4DERoq8WJvtcDjo1nDiw4=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Grid.css?h=8VW8TyCcN9Y4N+2rADmTboooQ+5p2/Yb+EeisoKqdzU=\" integrity=\"sha256-8VW8TyCcN9Y4N+2rADmTboooQ+5p2/Yb+EeisoKqdzU=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Icon.css?h=bIkVie0d8L4AerafPE0oshPhb3Tk3qw8StOPLEdNljg=\" integrity=\"sha256-bIkVie0d8L4AerafPE0oshPhb3Tk3qw8StOPLEdNljg=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Imposter.css?h=4kdcCeEb2Ld3R4TqZ73iLIVnjCZp1DZEiI7hPJ/QheU=\" integrity=\"sha256-4kdcCeEb2Ld3R4TqZ73iLIVnjCZp1DZEiI7hPJ/QheU=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Sidebar.css?h=foKlt80TBU7dmsagktCviAVYUP2UIxtXWb6Z2+ls68A=\" integrity=\"sha256-foKlt80TBU7dmsagktCviAVYUP2UIxtXWb6Z2+ls68A=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Stack.css?h=uq8qsVzAXoKbbn1h7f3vnLT4Lz4l2Pg1C41HtHwsPt8=\" integrity=\"sha256-uq8qsVzAXoKbbn1h7f3vnLT4Lz4l2Pg1C41HtHwsPt8=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Switcher.css?h=94KG+feE16JP+lxozAKEL1TbJvOc1EyRq+ErJafsnBs=\" integrity=\"sha256-94KG+feE16JP+lxozAKEL1TbJvOc1EyRq+ErJafsnBs=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout/Sidebar-l.css?h=4j+SCVp7iftwdRMfcijvW8NSrjtf/BMN0JBkCUhpjC0=\" integrity=\"sha256-4j+SCVp7iftwdRMfcijvW8NSrjtf/BMN0JBkCUhpjC0=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/every_layout_attribute_fouc.css?h=KUvRPwYbokZmCZocMBuBpGCotqMY2KSvkEawyubh4Y0=\" integrity=\"sha256-KUvRPwYbokZmCZocMBuBpGCotqMY2KSvkEawyubh4Y0=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/nav.css?h=MGhsEqWZqwk4LlFZ+t9lHULNGOryuVcWg98MtjY4K4Q=\" integrity=\"sha256-MGhsEqWZqwk4LlFZ+t9lHULNGOryuVcWg98MtjY4K4Q=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/highlight.css?h=QC4eQ7BQH/TXKum3ftCjnEFKsqMY/FrmuL8ELhWeRB0=\" integrity=\"sha256-QC4eQ7BQH/TXKum3ftCjnEFKsqMY/FrmuL8ELhWeRB0=\">\n        \n        \n        <link rel=\"stylesheet\" href=\"https://bonsai.io/static-assets/css/blog.css?h=IObbh3PMQMKB4jmeK7aZk8+9Fetwwc9jGuEEJv+LQ3I=\" integrity=\"sha256-IObbh3PMQMKB4jmeK7aZk8+9Fetwwc9jGuEEJv+LQ3I=\">\n        <meta name=\"description\" content=\"The first and only straightforward guide for implementing a good autocomplete solution in pure Elasticsearch or Opensearch, because all the other guides are terrible and don't work.\">\n        <meta property=\"og:description\" content=\"The first and only straightforward guide for implementing a good autocomplete solution in pure Elasticsearch or Opensearch, because all the other guides are terrible and don't work.\">\n\n    \n\n    <meta property=\"og:title\" content=\"How to really do autocomplete\">\n    <meta property=\"og:type\" content=\"article\">\n\n    \n    <meta property=\"og:locale\" content=\"en_US\">\n\n    <meta property=\"og:url\" content=\"https://bonsai.io/blog/how-to-really-do-autocomplete/\"><meta property=\"og:site_name\" content=\"Bonsai Blog | Fully Managed Elasticsearch &amp; OpenSearch\">\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Box.js?h=HslTkKMvGIB77XNGBaiG8qnxM6VBFwG0yG08dW8si1Q=\" integrity=\"sha256-HslTkKMvGIB77XNGBaiG8qnxM6VBFwG0yG08dW8si1Q=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Center.js?h=jsKMMHHQuU1OU17VoKXqeGenPp2l3dgOlsxooLg3QEo=\" integrity=\"sha256-jsKMMHHQuU1OU17VoKXqeGenPp2l3dgOlsxooLg3QEo=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Cluster.js?h=dgZCOxbNVo28rCwWrYRDLSxD2081G591IJPYteA7y6Q=\" integrity=\"sha256-dgZCOxbNVo28rCwWrYRDLSxD2081G591IJPYteA7y6Q=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Cover.js?h=IFcRpFNW11PoxlOunYo/WV8YIDI0ucvdBLimvTfVfpg=\" integrity=\"sha256-IFcRpFNW11PoxlOunYo/WV8YIDI0ucvdBLimvTfVfpg=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Frame.js?h=Ps/sUfM4Aj6018xhBzDwoh8CNOid7q294Rfrr8uix98=\" integrity=\"sha256-Ps/sUfM4Aj6018xhBzDwoh8CNOid7q294Rfrr8uix98=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Grid.js?h=gbsix2gJWFnYEtyV1N81JOZwFgVdOsqbaRV8fkDKaTY=\" integrity=\"sha256-gbsix2gJWFnYEtyV1N81JOZwFgVdOsqbaRV8fkDKaTY=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Icon.js?h=HbatmUVCdOtAwymg+mbiZUDDf4yEPKw+7hQh7cT52kI=\" integrity=\"sha256-HbatmUVCdOtAwymg+mbiZUDDf4yEPKw+7hQh7cT52kI=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Imposter.js?h=KPGFvWIrKzVBPSpZA3HVJ2u55PlsCEO4C2tPxw0p8AE=\" integrity=\"sha256-KPGFvWIrKzVBPSpZA3HVJ2u55PlsCEO4C2tPxw0p8AE=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Stack.js?h=uv0C1wuh6Zu0Hf9kd19olfOJwJgMX0jLwXQvJyDoQnQ=\" integrity=\"sha256-uv0C1wuh6Zu0Hf9kd19olfOJwJgMX0jLwXQvJyDoQnQ=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Switcher.js?h=Iu2ogDoJRkvBFamp1zxjDWC/Vv3JIeY0mnnYDDu3pTw=\" integrity=\"sha256-Iu2ogDoJRkvBFamp1zxjDWC/Vv3JIeY0mnnYDDu3pTw=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/every_layout/Sidebar-l.js?h=/JMI90Yz9T0kQe7d3A7Q3Z2JrYO3Xs5OZoA3B0W63kM=\" integrity=\"sha256-/JMI90Yz9T0kQe7d3A7Q3Z2JrYO3Xs5OZoA3B0W63kM=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/dropdown.js?h=AdeuQy+3sh9Vy4buVuKzTHfF1kfd5jmvAZeibiEcpl8=\" integrity=\"sha256-AdeuQy+3sh9Vy4buVuKzTHfF1kfd5jmvAZeibiEcpl8=\"></script>\n        \n        \n        <script defer=\"\" type=\"module\" src=\"https://bonsai.io/static-assets/js/mobile-nav.js?h=MxKWbhv7XhosHhaKzLbGQ7gu4rg4iSBcWO3/T5woG2I=\" integrity=\"sha256-MxKWbhv7XhosHhaKzLbGQ7gu4rg4iSBcWO3/T5woG2I=\"></script>\n\n<style id=\"Box-var(--s5)0blackfalse\">[data-i=\"Box-var(--s5)0blackfalse\"] { padding: var(--s5); border: 0 solid black; } [data-i=\"Box-var(--s5)0blackfalse\"] { background-color: inherit; }</style><style id=\"Box-var(--s1)0blackfalse\">[data-i=\"Box-var(--s1)0blackfalse\"] { padding: var(--s1); border: 0 solid black; } [data-i=\"Box-var(--s1)0blackfalse\"] { background-color: inherit; }</style><style id=\"Box-var(--s3)0blackfalse\">[data-i=\"Box-var(--s3)0blackfalse\"] { padding: var(--s3); border: 0 solid black; } [data-i=\"Box-var(--s3)0blackfalse\"] { background-color: inherit; }</style><style id=\"Center-var(--body-measure)falsefalse\">[data-i=\"Center-var(--body-measure)falsefalse\"] { max-width: var(--body-measure); }</style><style id=\"Center-var(--article-body-measure)falsefalse\">[data-i=\"Center-var(--article-body-measure)falsefalse\"] { max-width: var(--article-body-measure); }</style><style id=\"Center-var(--measure)falsefalse\">[data-i=\"Center-var(--measure)falsefalse\"] { max-width: var(--measure); }</style><style id=\"Cluster-flex-startflex-startvar(--s-3)\">[data-i=\"Cluster-flex-startflex-startvar(--s-3)\"] { justify-content: flex-start; align-items: flex-start; gap: var(--s-3); }</style><style id=\"Cluster-flex-startcentervar(--s1)\">[data-i=\"Cluster-flex-startcentervar(--s1)\"] { justify-content: flex-start; align-items: center; gap: var(--s1); }</style><style id=\"Cluster-flex-startcentervar(--s-3);\">[data-i=\"Cluster-flex-startcentervar(--s-3);\"] { justify-content: flex-start; align-items: center; gap: var(--s-3);; }</style><style id=\"Cover-box-lvar(--s1)100%true\">[data-i=\"Cover-box-lvar(--s1)100%true\"] { min-height: 100%; padding: 0; } [data-i=\"Cover-box-lvar(--s1)100%true\"] > * { margin-block: var(--s1); } [data-i=\"Cover-box-lvar(--s1)100%true\"] > :first-child:not(box-l) { margin-block-start: 0; } [data-i=\"Cover-box-lvar(--s1)100%true\"] > :last-child:not(box-l) { margin-block-end: 0; } [data-i=\"Cover-box-lvar(--s1)100%true\"] > box-l { margin-block: auto; }</style><style id=\"Cover-a0100%;true\">[data-i=\"Cover-a0100%;true\"] { min-height: 100%;; padding: 0; } [data-i=\"Cover-a0100%;true\"] > * { margin-block: 0; } [data-i=\"Cover-a0100%;true\"] > :first-child:not(a) { margin-block-start: 0; } [data-i=\"Cover-a0100%;true\"] > :last-child:not(a) { margin-block-end: 0; } [data-i=\"Cover-a0100%;true\"] > a { margin-block: auto; }</style><style id=\"Frame-1198:948\">[data-i=\"Frame-1198:948\"] { aspect-ratio: 1198 / 948; }</style><style id=\"Frame-1408:982\">[data-i=\"Frame-1408:982\"] { aspect-ratio: 1408 / 982; }</style><style id=\"Frame-980:914\">[data-i=\"Frame-980:914\"] { aspect-ratio: 980 / 914; }</style><style id=\"Frame-2158:918\">[data-i=\"Frame-2158:918\"] { aspect-ratio: 2158 / 918; }</style><style id=\"Frame-2158:1044\">[data-i=\"Frame-2158:1044\"] { aspect-ratio: 2158 / 1044; }</style><style id=\"Grid-250pxvar(--s3);\"> [data-i=\"Grid-250pxvar(--s3);\"] { grid-gap: var(--s3);; } [data-i=\"Grid-250pxvar(--s3);\"].grid-l--above { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); } @supports (width: min(250px, 100%)) { [data-i=\"Grid-250pxvar(--s3);\"] { grid-gap: var(--s3);; grid-template-columns: repeat(auto-fill, minmax(min(250px, 100%), 1fr)); } } </style><style id=\"Icon-0\">[data-i=\"Icon-0\"] { display: inline-flex; } [data-i=\"Icon-0\"] > svg { margin-inline-end: 0; }</style><style id=\"Stack-var(--s1)false\">[data-i=\"Stack-var(--s1)false\"] > * + * { margin-block-start: var(--s1); }</style><style id=\"Stack-var(--s-3)false2\">[data-i=\"Stack-var(--s-3)false2\"] > * + * { margin-block-start: var(--s-3); } [data-i=\"Stack-var(--s-3)false2\"]:only-child { block-size: 100%; } [data-i=\"Stack-var(--s-3)false2\"] > :nth-child(2) { margin-block-end: auto; }</style><style id=\"Stack-0false\">[data-i=\"Stack-0false\"] > * + * { margin-block-start: 0; }</style><style id=\"Stack-var(--s3)false\">[data-i=\"Stack-var(--s3)false\"] > * + * { margin-block-start: var(--s3); }</style><style id=\"Switcher-40remvar(--s1)5\">[data-i=\"Switcher-40remvar(--s1)5\"] { gap: var(--s1); } [data-i=\"Switcher-40remvar(--s1)5\"] > * { flex-basis: calc((40rem - 100%) * 999); } [data-i=\"Switcher-40remvar(--s1)5\"] > :nth-last-child(n+6), [data-i=\"Switcher-40remvar(--s1)5\"] > :nth-last-child(n+6) ~ * { flex-basis: 100%; }</style><style id=\"Sidebar-left48ch33%var(--s1)\">[data-i=\"Sidebar-left48ch33%var(--s1)\"] { gap: var(--s1); } [data-i=\"Sidebar-left48ch33%var(--s1)\"] > * { flex-basis: 48ch; } [data-i=\"Sidebar-left48ch33%var(--s1)\"] > :last-child { flex-basis: 0; flex-grow: 999; min-inline-size: 33%; }</style><style id=\"Sidebar-left50%var(--s1)\">[data-i=\"Sidebar-left50%var(--s1)\"] { gap: var(--s1); } [data-i=\"Sidebar-left50%var(--s1)\"] > * { } [data-i=\"Sidebar-left50%var(--s1)\"] > :last-child { flex-basis: 0; flex-grow: 999; min-inline-size: 50%; }</style><style id=\"Sidebar-left42ch50%var(--s7)\">[data-i=\"Sidebar-left42ch50%var(--s7)\"] { gap: var(--s7); } [data-i=\"Sidebar-left42ch50%var(--s7)\"] > * { flex-basis: 42ch; } [data-i=\"Sidebar-left42ch50%var(--s7)\"] > :last-child { flex-basis: 0; flex-grow: 999; min-inline-size: 50%; }</style></head>\n\n\n<body>\n    <div class=\"nav-bg\">\n\n    <center-l max=\"var(--body-measure)\" data-i=\"Center-var(--body-measure)falsefalse\">\n\n        <div data-w-id=\"e36f4890-9d82-1a67-974e-dbb0b1baafd1\" data-animation=\"default\" data-collapse=\"medium\" data-duration=\"400\" data-easing=\"ease\" data-easing2=\"ease\" role=\"banner\" class=\"navbar w-nav\" style=\"\">\n            <nav class=\"container-nav w-container\"><a href=\"/\" class=\"brand w-nav-brand\" aria-label=\"home\">\n                    <div class=\"logo-embed w-embed\" style=\"color: rgb(224, 244, 227);\">\n                        <svg width=\"100\" height=\"28\" viewBox=\"0 0 100 28\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <path d=\"M91.774 4.36102V0.965023C91.774 0.698023 92.107 0.506023 92.775 0.390023C93.4105 0.276902 94.0545 0.218687 94.7 0.216023C95.025 0.216023 95.289 0.297023 95.492 0.460023C95.695 0.623023 95.797 0.860023 95.797 1.17402V4.13502C95.797 4.44802 95.692 4.68902 95.483 4.85802C95.274 5.02602 95.013 5.11002 94.7 5.11002C94.084 5.11002 93.443 5.05202 92.775 4.93602C92.107 4.82002 91.774 4.62802 91.774 4.36102M91.739 22.267V8.31502C91.739 8.17602 91.855 8.05702 92.087 7.95802C92.3717 7.84708 92.6707 7.77673 92.975 7.74902C93.335 7.70802 93.655 7.67902 93.934 7.66202C94.212 7.64402 94.467 7.63602 94.7 7.63602C95.002 7.63602 95.254 7.70902 95.457 7.85402C95.66 8.00002 95.762 8.21202 95.762 8.49102V21.548C95.762 22.269 95.858 22.79 96.05 23.11C96.241 23.43 96.633 23.591 97.225 23.591C97.341 23.591 97.905 23.492 98.915 23.294C99.136 23.294 99.333 23.593 99.507 24.191C99.681 24.79 99.768 25.286 99.768 25.68C99.768 26.76 98.578 27.3 96.198 27.3C94.746 27.3 93.64 26.911 92.879 26.133C92.119 25.356 91.739 24.067 91.739 22.267M76.899 21.518C76.899 22.586 77.152 23.323 77.657 23.73C78.162 24.136 79.053 24.34 80.33 24.34C80.911 24.34 81.558 24.273 82.273 24.139C82.987 24.006 83.454 23.869 83.675 23.73V19.34C83.477 19.224 82.963 19.082 82.133 18.914C81.303 18.745 80.58 18.661 79.965 18.661C78.838 18.661 78.045 18.856 77.587 19.245C77.128 19.634 76.899 20.391 76.899 21.518M73.015 21.222C73.015 20.293 73.105 19.503 73.285 18.853C73.465 18.203 73.775 17.633 74.217 17.146C74.658 16.658 75.27 16.295 76.054 16.057C76.838 15.819 77.81 15.7 78.972 15.7C80.4 15.7 81.968 15.926 83.675 16.379V14.118C83.675 13.008 83.358 12.21 82.725 11.725C82.092 11.24 80.992 10.997 79.425 10.997C78.182 10.997 76.672 11.149 74.896 11.45C74.559 11.45 74.321 11.198 74.182 10.693C74.0474 10.2196 73.9771 9.7302 73.973 9.23802C73.973 8.87902 74.005 8.63202 74.069 8.49802C74.103 8.42938 74.1508 8.36841 74.2092 8.31889C74.2677 8.26936 74.3357 8.23231 74.409 8.21002C74.838 8.08302 75.633 7.95502 76.794 7.82702C77.9683 7.69917 79.1487 7.63541 80.33 7.63602C81.596 7.63602 82.653 7.72902 83.5 7.91402C84.348 8.10002 85.091 8.42802 85.73 8.89802C86.368 9.36902 86.833 10.025 87.123 10.867C87.413 11.709 87.559 12.774 87.559 14.063V25.158C87.559 25.437 87.254 25.741 86.644 26.072C86.035 26.403 85.152 26.691 83.997 26.934C82.7794 27.1842 81.539 27.3069 80.296 27.3C77.683 27.3 75.816 26.819 74.696 25.854C73.575 24.891 73.015 23.347 73.015 21.222M56.625 26.046C56.625 25.988 56.648 25.843 56.694 25.611C56.822 24.705 56.967 24.104 57.129 23.808C57.291 23.512 57.505 23.364 57.773 23.364H57.946C59.511 23.584 60.948 23.695 62.258 23.695C63.638 23.695 64.669 23.557 65.353 23.279C66.037 23.001 66.379 22.522 66.379 21.84C66.379 21.366 66.21 20.951 65.873 20.593C65.537 20.235 65.096 19.935 64.55 19.693C63.956 19.4307 63.3547 19.1849 62.747 18.956C62.0765 18.7018 61.4196 18.4131 60.779 18.091C60.1405 17.7726 59.5364 17.3896 58.976 16.948C58.43 16.515 57.989 15.94 57.652 15.224C57.316 14.508 57.147 13.689 57.147 12.765C57.147 11.914 57.287 11.169 57.565 10.533C57.844 9.89702 58.198 9.39802 58.628 9.03602C59.057 8.67502 59.595 8.38602 60.239 8.17002C60.8439 7.96305 61.4685 7.81928 62.103 7.74102C62.701 7.67102 63.377 7.63602 64.132 7.63602C66.64 7.63602 68.376 7.71802 69.34 7.88202C69.793 7.96402 70.019 8.31602 70.019 8.93702C70.019 9.66302 69.929 10.27 69.749 10.756C69.569 11.242 69.363 11.485 69.131 11.485C68.852 11.485 68.286 11.445 67.432 11.363C66.6826 11.2873 65.9302 11.2466 65.177 11.241C63.83 11.241 62.826 11.363 62.164 11.605C61.502 11.847 61.171 12.269 61.171 12.869C61.171 13.262 61.339 13.614 61.676 13.925C62.013 14.238 62.454 14.506 63 14.731C63.545 14.956 64.146 15.187 64.803 15.423C65.458 15.66 66.113 15.952 66.766 16.298C67.4058 16.6364 68.009 17.0398 68.566 17.502C69.114 17.958 69.557 18.555 69.895 19.294C70.233 20.033 70.402 20.882 70.402 21.84C70.402 22.727 70.269 23.5 70.002 24.159C69.735 24.818 69.386 25.343 68.957 25.734C68.527 26.125 67.987 26.44 67.337 26.679C66.7007 26.9143 66.0403 27.0786 65.368 27.169C64.6229 27.2612 63.8727 27.305 63.122 27.3C60.544 27.3 58.593 27.109 57.269 26.725C56.84 26.633 56.625 26.406 56.625 26.046M38.075 26.586V10.736C38.075 10.411 38.345 10.063 38.885 9.69102C39.425 9.32002 40.122 8.98302 40.975 8.68102C41.829 8.37902 42.83 8.12902 43.98 7.93202C45.1016 7.73724 46.2377 7.63821 47.376 7.63602C48.328 7.63602 49.138 7.72302 49.806 7.89702C50.473 8.07102 51.016 8.31502 51.435 8.62802C51.853 8.94202 52.18 9.37202 52.419 9.91702C52.657 10.463 52.816 11.05 52.898 11.677C52.978 12.304 53.02 13.076 53.02 13.993V26.394C53.02 26.697 52.903 26.923 52.671 27.074C52.4322 27.2268 52.1535 27.3055 51.87 27.3C51.231 27.3 50.593 27.248 49.954 27.143C49.315 27.039 48.996 26.853 48.996 26.586V13.837C48.996 12.907 48.839 12.26 48.526 11.894C48.212 11.529 47.591 11.346 46.662 11.346C45.802 11.346 44.827 11.497 43.736 11.799C42.644 12.101 42.099 12.356 42.099 12.565V26.394C42.099 26.697 41.994 26.923 41.785 27.074C41.576 27.225 41.315 27.3 41.001 27.3C40.374 27.3 39.73 27.248 39.068 27.143C38.406 27.039 38.075 26.853 38.075 26.586M22.643 20.646C22.643 21.778 22.898 22.569 23.408 23.019C23.918 23.47 24.85 23.695 26.206 23.695H26.518C27.874 23.695 28.812 23.464 29.333 23.002C29.854 22.54 30.115 21.755 30.115 20.646V14.324C30.115 13.169 29.857 12.367 29.342 11.917C28.827 11.466 27.885 11.241 26.518 11.241H26.24C24.885 11.241 23.946 11.469 23.425 11.925C22.904 12.382 22.643 13.181 22.643 14.324V20.646V20.646ZM18.619 20.629V14.307C18.619 11.787 19.198 10.045 20.355 9.08102C21.511 8.11802 23.479 7.63602 26.257 7.63602H26.432C27.85 7.63602 29.027 7.74302 29.963 7.95802C30.898 8.17302 31.689 8.53602 32.334 9.04602C32.979 9.55802 33.441 10.24 33.72 11.093C33.999 11.947 34.139 13.018 34.139 14.307V20.629C34.139 21.918 33.999 22.99 33.72 23.843C33.441 24.696 32.979 25.379 32.334 25.889C31.689 26.401 30.898 26.763 29.963 26.978C29.027 27.193 27.85 27.3 26.432 27.3H26.257C23.467 27.3 21.497 26.819 20.346 25.854C19.195 24.891 18.619 23.15 18.619 20.629V20.629ZM4.023 23.431C4.023 23.489 4.202 23.559 4.562 23.641C4.921 23.723 5.376 23.793 5.925 23.851C6.476 23.91 6.994 23.939 7.481 23.939C8.21 23.939 8.813 23.851 9.287 23.676C9.762 23.501 10.104 23.247 10.312 22.914C10.5075 22.614 10.6487 22.282 10.729 21.933C10.799 21.612 10.834 21.218 10.834 20.751V14.429C10.834 13.973 10.805 13.582 10.747 13.256C10.684 12.9132 10.5758 12.5803 10.425 12.266C10.2646 11.9293 9.99102 11.6596 9.652 11.504C9.293 11.329 8.841 11.241 8.297 11.241C7.44 11.241 6.522 11.396 5.543 11.706C4.565 12.015 4.058 12.28 4.023 12.502V23.431V23.431ZM0 24.862V0.825023C0 0.559023 0.331 0.372023 0.992 0.268023C1.65184 0.163359 2.31891 0.110863 2.987 0.111023C3.678 0.111023 4.023 0.506023 4.023 1.29602V9.13402C5.795 8.13502 7.579 7.63602 9.374 7.63602C10.28 7.63602 11.068 7.76402 11.742 8.01902C12.414 8.27402 12.945 8.60202 13.334 9.00302C13.722 9.40402 14.036 9.90602 14.274 10.51C14.512 11.114 14.669 11.715 14.744 12.312C14.819 12.911 14.857 13.587 14.857 14.342V20.734C14.857 21.767 14.747 22.664 14.527 23.425C14.3083 24.1816 13.9248 24.8803 13.404 25.471C12.876 26.075 12.131 26.531 11.169 26.839C10.206 27.146 9.023 27.3 7.62 27.3C4.52 27.3 2.231 26.929 0.751 26.185C0.471 26.046 0.276 25.878 0.166 25.68C0.055 25.483 0 25.21 0 24.862H0Z\" fill=\"currentColor\"></path>\n                        </svg>\n                    </div>\n                    <div class=\"descriptive-text\">Bonsai-logo</div>\n                </a>\n                <nav role=\"navigation\" class=\"nav-menu w-nav-menu\" style=\"will-change: background; background-color: rgb(13, 56, 61);\">\n                    <div class=\"nav-menu-wrapper\">\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"/about\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227); max-width: 1360px;\">About</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"/vector-search\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227); max-width: 1360px;\">Vector\n                                Search</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"/enterprise\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227); max-width: 1360px;\">Enterprise</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"/pricing\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227); max-width: 1360px;\">Pricing</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <div data-hover=\"false\" data-delay=\"0\" class=\"dropdown w-dropdown\" style=\"max-width: 1360px;\">\n                                <div class=\"link-nav dd w-dropdown-toggle\" style=\"color: rgb(224, 244, 227);\" id=\"w-dropdown-toggle-0\" aria-controls=\"w-dropdown-list-0\" aria-haspopup=\"menu\" aria-expanded=\"false\" role=\"button\" tabindex=\"0\">\n                                    <div>Resources</div>\n                                    <div class=\"dd-icon\">\n                                        <div class=\"w-embed\">\n                                            <svg width=\"12\" height=\"8\" viewBox=\"0 0 12 8\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                                <path d=\"M0 1.75898C0 1.62985 0 1.50073 0.129126 1.50073L1.03301 0.596845C1.16214 0.467718 1.42039 0.467718 1.54951 0.596845L5.55243 4.59976L9.55534 0.596845C9.81359 0.467718 10.0718 0.467718 10.201 0.596845L11.1049 1.50073C11.1049 1.50073 11.234 1.62985 11.234 1.75898C11.234 1.88811 11.234 2.01723 11.1049 2.01723L5.93981 7.05316C5.81068 7.18228 5.55243 7.18228 5.29417 7.05316L0.129126 2.01723C0 1.88811 0 1.75898 0 1.75898Z\" fill=\"currentColor\"></path>\n                                            </svg>\n                                        </div>\n                                    </div>\n                                </div>\n                                <nav class=\"resources-dropdown w-dropdown-list\" id=\"w-dropdown-list-0\" aria-labelledby=\"w-dropdown-toggle-0\">\n                                    <a href=\"/blog\" aria-current=\"page\" class=\"dd-link w-dropdown-link w--current\" tabindex=\"0\">Blog</a><a href=\"/announcements\" class=\"dd-link w-dropdown-link\" tabindex=\"0\">Announcements</a><a href=\"/docs\" target=\"_blank\" class=\"dd-link w-dropdown-link\" tabindex=\"0\">Docs</a><a href=\"/success-stories\" class=\"dd-link w-dropdown-link\" tabindex=\"0\">Success\n                                        Stories</a><a href=\"/services/search-relevancy-assessment\" class=\"dd-link w-dropdown-link\" tabindex=\"0\">Search Assessment</a>\n                                </nav>\n                            </div>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"/contact\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227); max-width: 1360px;\">Contact</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"https://app.bonsai.io/login\" class=\"link-nav w-nav-link\" style=\"color: rgb(224, 244, 227);\">Login</a>\n                            <div class=\"nav-link-border\"></div>\n                        </div>\n                        <div class=\"nav-link-wrap\">\n                            <a href=\"https://app.bonsai.io/signup\" class=\"btn nav w-button\">Sign up</a></div>\n                    </div>\n                </nav>\n                <div class=\"menu-btn w-nav-button\" style=\"-webkit-user-select: text;\" aria-label=\"menu\" role=\"button\" tabindex=\"0\" aria-controls=\"w-nav-overlay-0\" aria-haspopup=\"menu\" aria-expanded=\"false\">\n                    <div class=\"menu-lines\">\n                        <div class=\"menu-top-line-light\" style=\"will-change: background; background-color: rgb(224, 244, 227);\"></div>\n                        <div class=\"menu-mid-line-light\" style=\"will-change: background; background-color: rgb(224, 244, 227);\"></div>\n                        <div class=\"menu-bot-line-light\" style=\"will-change: background; background-color: rgb(224, 244, 227);\"></div>\n                    </div>\n                </div>\n            </nav>\n            <div class=\"w-nav-overlay\" data-wf-ignore=\"\" id=\"w-nav-overlay-0\"></div>\n            <div class=\"nav-shadow-light\" style=\"will-change: opacity; opacity: 1;\"></div>\n        </div>\n    </center-l>\n</div>\n\n\n    <stack-l data-i=\"Stack-var(--s1)false\">\n\n        <div class=\"container\">\n            \n            <div class=\"position:relative\">\n        <stack-l class=\"article\" space=\"var(--s1)\" data-i=\"Stack-var(--s1)false\"><div class=\"position:relative title-section\">\n    <center-l max=\"var(--article-body-measure)\" data-i=\"Center-var(--article-body-measure)falsefalse\">\n        <box-l class=\"pad-tb-only\" padding=\"var(--s5)\" data-i=\"Box-var(--s5)0blackfalse\">\n            <stack-l splitafter=\"2\" space=\"var(--s-3)\" data-i=\"Stack-var(--s-3)false2\">\n                    <p class=\"date\">\n                        Jun 6, 2025\n                    </p>\n                \n\n                <h1 class=\"article-title\">\n                    How to really do autocomplete\n                </h1>\n\n                <box-l class=\"pad-tb-only no-pad-bottom\" data-i=\"Box-var(--s1)0blackfalse\">\n                    <cluster-l space=\"var(--s-3)\" class=\"meta\" data-i=\"Cluster-flex-startflex-startvar(--s-3)\"><div>Max Irwin</div><span class=\"separator\" aria-hidden=\"true\">•</span><div class=\"tag\"><a href=\"https://bonsai.io/tags/search/\">Search</a>,&nbsp;</div><div class=\"tag\"><a href=\"https://bonsai.io/tags/autocomplete/\">Autocomplete</a>,&nbsp;</div><div class=\"tag\"><a href=\"https://bonsai.io/tags/typeahead/\">Typeahead</a>,&nbsp;</div><div class=\"tag\"><a href=\"https://bonsai.io/tags/autosuggest/\">Autosuggest</a></div><span class=\"separator\" aria-hidden=\"true\">•</span><div title=\"2211 words\">\n                                12 min read\n                            </div>\n                    </cluster-l>\n                </box-l>\n            </stack-l>\n        </box-l>\n    </center-l>\n</div>\n<main class=\"content\">\n                <center-l max=\"var(--article-body-measure)\" data-i=\"Center-var(--article-body-measure)falsefalse\">\n                    <stack-l data-i=\"Stack-var(--s1)false\">\n                        <p>I love autocomplete. It's one of those things that everyone realizes they need early in their search journey. And it's\nusually the first thing people start with right after their search relevance is at a good enough baseline.</p>\n<p>I love it so much that it's the first chapter I wrote for <a href=\"https://aipoweredsearch.com/\">AI-Powered Search</a> as a\nbaby-step into vector search. That\nchapter, though, uses fancy tools like <a href=\"https://spacy.io/\">SpaCy</a> and self-hosted transformer models. But what if you're\nnot ready for that\nyet? You've already got Elastic or OpenSearch and want something more out-of-the-box? Well, dear reader, you have once\nagain found yourself in the right place.</p>\n<p>One of my main gripes about just basic autocomplete is that nobody really tells you how to do it. The internet is filled\nwith half-baked Medium posts, Stackoverflow questions, and incomplete-yet-official docs from the engines. This is\nsomething missing from the internet, and I can stand it no longer.</p>\n<h2 id=\"give-the-people-what-they-want\">Give the people what they want</h2>\n<p>Before diving into a solution, we need to be diligent and start from the problem: what people expect when they start\ntyping into a search bar.</p>\n<p>The problem is that people may or may not know what to search for. More importantly:\n<em><strong>they might not know what content your site has, or they might not know how to express themselves.</strong></em></p>\n<p>So, when people start typing, they want to see two kinds of suggestions: (1) pages, and (2) what to search.</p>\n<p>Both are very helpful, and as a side benefit also exist to save the people's precious fingers from the brutal exhaustion\nof further typing.</p>\n<p>Let's see an example implementation from the eponymous standard set by Google long ago:</p>\n\n    <center-l data-i=\"Center-var(--measure)falsefalse\">\n        <box-l data-i=\"Box-var(--s1)0blackfalse\">\n            <frame-l ratio=\"1198:948\" data-i=\"Frame-1198:948\"><img src=\"https://bonsai.io/blog/how-to-really-do-autocomplete/image.png?h=Gj8+96i1wyez8dPREn8ExRRDBu+oRvgnNb2LbxrcZfs=\" alt=\"Google's autosuggest for ‘opense'\">\n            </frame-l>\n        </box-l>\n    </center-l>\n<p><em>Google's autosuggest for ‘opense'</em></p>\n<p>There you have it, a solid mix of terms and sites to choose from: a simple-to-understand list of things that people\nmight be looking for.</p>\n<p>So, we have our problem, and we have a solution direction. But what lore exists for us?</p>\n<h2 id=\"existing-documentation\">Existing Documentation</h2>\n<p>If you were lucky, when web-searching how to solve autocomplete for Elastic or OpenSearch, you've stumbled upon this\nvery article.</p>\n<p>If you were almost-lucky, you found <a href=\"https://opensearch.org/docs/latest/search-plugins/searching-data/autocomplete/\"><em>this article in the OpenSearch docs</em></a>.</p>\n<p>I will say, it's an excellent article. But it's deceptive. Deviously deceptive. Because it leaves out a key detail that\nyou won't realize until you're knee-deep in implementing some of its recommended approaches.</p>\n<p>That and all other articles are dependent on you already having short phrases and words that you want to suggest! That's\nright. It doesn't show you how to generate suggested terms or phrases from actual documents that everyone uses. The\nclosest you will get are titles (great for the pages suggestions) or nominal metadata such as categories (which is not\nnearly comprehensive enough to cover all potential search prefixes).</p>\n<p>You've got paragraphs of descriptions and body text and are looking for a way to produce your suggestion vocabulary, and\nNOBODY tells you how. It's something you have to figure out on your own! In a cave! With a box of scraps! (until now)</p>\n\n    <center-l data-i=\"Center-var(--measure)falsefalse\">\n        <box-l data-i=\"Box-var(--s1)0blackfalse\">\n            <frame-l ratio=\"1408:982\" data-i=\"Frame-1408:982\"><img src=\"https://bonsai.io/blog/how-to-really-do-autocomplete/image-1.png?h=bSx+kHMGvTfRUFzvvPGErZnN87lPnsg/JAIqFNqQWTU=\" alt=\"How did they do it?!\">\n            </frame-l>\n        </box-l>\n    </center-l>\n<p><em>How did they do it?!</em></p>\n<p>This is what we're going to build:</p>\n<div style=\"background-color:rgba(0,0,0,0.1)\">\n    \n    <center-l data-i=\"Center-var(--measure)falsefalse\">\n        <box-l data-i=\"Box-var(--s1)0blackfalse\">\n            <frame-l ratio=\"980:914\" data-i=\"Frame-980:914\"><video width=\"100%\" autoplay=\"\" muted=\"\" loop=\"\" playsinline=\"\">\n                  <source src=\"https://bonsai.io/blog/how-to-really-do-autocomplete/autocomplete-lg.mp4?h=oCHFxKH5ki7MPYL1EKYtC5ttsiaPqYaM0cOVGF7ho/E=\" type=\"video/mp4\">\n                  Your browser does not support the video tag.\n                </video>\n            </frame-l>\n        </box-l>\n    </center-l>\n\n</div>\n<h2 id=\"let-s-get-crackin\">Let's get crackin'</h2>\n<p>The other thing I don't like about many articles is they dance around what to do. An analyzer here, a query technique\nthere, maybe some trite examples of content. We're going to use an actual example of actual content, and walk through\nexactly what to do, one step at a time.</p>\n<h2 id=\"our-content-example\">Our Content Example</h2>\n<p>Surprise! We're using Bonsai's website content. Bonsai has about 260 pages of juicy texty material. It's a mix of\ncompany info, policies, technical docs, and blog posts. Here's what an actual article looks like once it's ready for\ningestion into OpenSearch:</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">docid</span><span>\": \"</span><span style=\"color:#a3be8c;\">da93fd39-8d4f-6051-66f7-a011dfce08a8</span><span>\",\n</span><span>  \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/docs/shard-primer</span><span>\",\n</span><span>  \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">Shard Primer</span><span>\",\n</span><span>  \"</span><span style=\"color:#a3be8c;\">description</span><span>\": \"</span><span style=\"color:#a3be8c;\">This article explains what shards are, how they work, and how they can best be used.</span><span>\",\n</span><span>  \"</span><span style=\"color:#a3be8c;\">body</span><span>\": \"</span><span style=\"color:#a3be8c;\">Shard Primer</span><span style=\"color:#96b5b4;\">\\n</span><span style=\"color:#a3be8c;\">For people new to Elasticsearch, shards can be a bit of a mystery. Why is it possible to add or remove replica shards on demand, but not primary shards? What's the difference? ... article continues.</span><span>\"\n</span><span>}\n</span></code></pre>\n<p>That's it. Other documents have more metadata (like author and publish date), but this document is simple, and a worthy\nexample. Like all texty documents, it is choc-full of words and phrases that people might want suggestions for: \"primary\nshards\", \"replication\", \"high-availability\", \"overallocation\" and many more.</p>\n<h2 id=\"our-baseline-index-configuration\">Our Baseline Index Configuration</h2>\n<p>I'm old school. I call Mappings and Settings a schema, like someone from the dark ages of search, when we hand coded\nJava plugins and shouted in anger at classpaths.</p>\n<p>This is what the schema looks like starting out. It doesn't have the things we need yet for autocomplete, it's probably\nsimilar to how you're starting… it is concise and ready to index a bunch of content for our site.</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">mappings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">properties</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">docid</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\":          { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\"] },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">image</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">published</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">modified</span><span>\":     { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">author</span><span>\":       { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\":{ \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_depth</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">integer</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">description</span><span>\":  { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">body</span><span>\":         { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\",\"</span><span style=\"color:#a3be8c;\">term_vector</span><span>\": \"</span><span style=\"color:#a3be8c;\">with_positions_offsets</span><span>\"}\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">settings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analysis</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stop</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">stopwords</span><span>\": \"</span><span style=\"color:#a3be8c;\">_english_</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">english</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">possessive_english</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\"\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\"\n</span><span>          ]\n</span><span>        }\n</span><span>\n</span><span>      }\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_shards</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_replicas</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>As bare-bones as you can get. This might not be perfectly relevant (I have lots of other stuff going on in the real\nindex), but it's good enough for illustration of a starting point for autocomplete.</p>\n<h2 id=\"steps-for-implementation\">Steps for implementation</h2>\n<p>This is the outline of the things we're going to add to reach autocomplete happiness. First, I'll list the pieces, then I'll define them.</p>\n<ol>\n<li>A <code>completion</code> field with an <code>Edge-ngram</code> tokenizer</li>\n<li>A <code>suggest_words</code> field with <code>fielddata</code> set to <code>true</code>, and a less aggressive stemmer</li>\n<li>A <code>suggest_phrases</code> field with <code>fielddata</code> set to <code>true</code>, and a shingles analyzer</li>\n<li>A query, that uses the above fields to suggest search terms</li>\n<li>Post-processing (optional), which we can only do in some basic client-side code.</li>\n</ol>\n<h3 id=\"step-1-completions-using-edge-ngrams\">Step 1: Completions using Edge-ngrams</h3>\n<p>Our first step is a double-whammy. We'll use a new <code>completion</code> field to get page suggestions AND match content to drive\nour search term suggestions. If you wanted to only provide page suggestions, you can implement this one step and stop!</p>\n<p>When typing, we need to be able to find where possible terms begin (the prefix). We could use <code>match_prefix_query</code>, but\nthat's slow. So instead we're going to speed things up at the cost of memory by using the <code>edge-ngram</code> tokenizer. Rather\nthan rewrite what this does, I'll link to the canonical reference if you want to learn\nmore: https://opensearch.org/docs/latest/search-plugins/searching-data/autocomplete/#edge-n-gram-matching</p>\n<p>For the <code>edge-ngram tokenizer</code>, we need a <code>tokenizer</code>, an <code>analyzer</code>, and a <code>field</code>:</p>\n<p><strong>Tokenizer</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">min_gram</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_gram</span><span>\": </span><span style=\"color:#d08770;\">25</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">token_chars</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">letter</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">digit</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">punctuation</span><span>\"\n</span><span>    ]\n</span><span>  }\n</span></code></pre>\n<p><strong>Analyzer:</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"\n</span><span>    ],\n</span><span>    \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\"\n</span><span>    ]\n</span><span>  }\n</span></code></pre>\n<p><strong>Field:</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">fields</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">raw</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\"\n</span><span>      }\n</span><span>    }\n</span><span>  }\n</span></code></pre>\n<p>With all three of the above in place, we need to modify some existing fields to copy them into the <code>completion</code> field. For\nthis guide, we're going to use both <code>title</code> and <code>description</code>.</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span style=\"color:#65737e;\">// ...\n</span><span>\"</span><span style=\"color:#a3be8c;\">title</span><span>\":       { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\"]},\n</span><span>\"</span><span style=\"color:#a3be8c;\">description</span><span>\": { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\"]},\n</span><span style=\"color:#65737e;\">// ...\n</span></code></pre>\n<p>For our example, I'm going to create a new index, with our new schema, and reindex content into it. That way we can see\nthings step-by-step. Just copy this thing straight into your dev tools (Kibana or Dashboards), and run!</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#65737e;\"># Step 1: Completions point\n</span><span style=\"color:#b48ead;\">PUT </span><span style=\"color:#a3be8c;\">/autocomplete-example\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">mappings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">properties</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">docid</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\":          { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\"] },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">image</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">published</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">modified</span><span>\":     { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">author</span><span>\":       { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\":{ \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_depth</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">integer</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">description</span><span>\":  { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">body</span><span>\":         { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">term_vector</span><span>\": \"</span><span style=\"color:#a3be8c;\">with_positions_offsets</span><span>\"},\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">fields</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">raw</span><span>\": {\n</span><span>            \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\"\n</span><span>          }\n</span><span>        }\n</span><span>      }\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">settings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analysis</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stop</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">stopwords</span><span>\": \"</span><span style=\"color:#a3be8c;\">_english_</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">english</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">possessive_english</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">min_gram</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">max_gram</span><span>\": </span><span style=\"color:#d08770;\">25</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">token_chars</span><span>\": [\"</span><span style=\"color:#a3be8c;\">letter</span><span>\", \"</span><span style=\"color:#a3be8c;\">digit</span><span>\", \"</span><span style=\"color:#a3be8c;\">punctuation</span><span>\"]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\"\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\"\n</span><span>          ]\n</span><span>        }\n</span><span>\n</span><span>      }\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_shards</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_replicas</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">_reindex\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">bonsai</span><span>\"\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">dest</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\"\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>OK! We're ready to try our first query! It's really basic, and works well. I'm going to imagine someone got as far as\ntyping \"ope\", using a match on <code>completion</code> with our prefix.</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">/autocomplete-example/_search\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">query</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">match</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope</span><span>\"\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": [\n</span><span>    \"</span><span style=\"color:#a3be8c;\">title</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">url</span><span>\"\n</span><span>  ],\n</span><span>  \"</span><span style=\"color:#a3be8c;\">size</span><span>\": </span><span style=\"color:#d08770;\">3\n</span><span>}\n</span></code></pre>\n<p><em>Results in...</em></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">took</span><span>\": </span><span style=\"color:#d08770;\">61</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">timed_out</span><span>\": </span><span style=\"color:#d08770;\">false</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_shards</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">successful</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">skipped</span><span>\": </span><span style=\"color:#d08770;\">0</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">failed</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">value</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">relation</span><span>\": \"</span><span style=\"color:#a3be8c;\">eq</span><span>\"\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_score</span><span>\": </span><span style=\"color:#d08770;\">6.6680512</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": [\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">bfb9fe25-8742-1067-026a-428025c41672</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.6680512</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">Compare Bonsai OpenSearch to AWS OpenSearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/vs/amazon-opensearch-service</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">db637423-cf63-24c5-32ac-68c309c62fbe</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.501189</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">Up and Running with OpenSearch – Bonsai</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/blog/up-and-running-with-opensearch</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">9a160271-5f4b-fc7f-1215-fdf63f2d9cc3</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.486245</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">OpenSearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/category/opensearch</span><span>\"\n</span><span>        }\n</span><span>      }\n</span><span>    ]\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>Well, that's pretty freakin' great.</p>\n<h3 id=\"step-2-suggest-words\">Step 2: Suggest Words</h3>\n<p>Suggesting individual words is pretty easy. I don't know why the guides don't at least show this basic example. Here's\nwhat we need:</p>\n<ul>\n<li>A new field: <code>suggest_word</code></li>\n<li>Less aggressive stemming</li>\n<li><code>fielddata=true</code></li>\n</ul>\n<p>We already have the stemmer we want in our filters: <code>english_possessive_stem</code>. We'll use that and remove stop words (we\ndon't want be silly and suggest words like \"the\" when people are looking for something like \"theme\")</p>\n<p>At query time, we're going to use the <code>significant_terms</code> aggregation on our new <code>suggest_word</code> field. This is our\nshouldn't-be-a-secret sauce. From the OpenSearch docs:</p>\n<center-l class=\"blockquote\" max=\"var(--article-body-measure)\" data-i=\"Center-var(--article-body-measure)falsefalse\">\n\n    <blockquote>\n        \n        <p>\n            <span class=\"quotations\">“</span>\n        </p>\n        <box-l borderwidth=\"0\" padding=\"var(--s1)\" class=\"content pad-rl-only\" data-i=\"Box-var(--s1)0blackfalse\"><p>The <code>significant_terms</code> aggregation lets you spot unusual or interesting term occurrences in a filtered subset relative\nto the rest of the data in an index.</p>\n</box-l>\n        <p>\n            <span class=\"quotations quotation-end\">”</span>\n        </p>\n    </blockquote>\n    \n        <center-l class=\"author \" data-i=\"Center-var(--measure)falsefalse\">\n            \n                <a href=\"https://opensearch.org/docs/latest/aggregations/bucket/significant-terms/\">OpenSearch Docs</a>\n            \n        </center-l>\n    \n</center-l>\n<p><strong>Analyzer</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"\n</span><span>    ],\n</span><span>    \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\"\n</span><span>    ]\n</span><span>  }\n</span></code></pre>\n<p><strong>Field</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">fielddata</span><span>\": </span><span style=\"color:#d08770;\">true\n</span><span>  }\n</span></code></pre>\n<p>With those in place, we need some <code>copy_tos</code>. I'm going to use <code>title</code> and <code>description</code>. You can and should also\nexperiment when you add body.</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>...\n</span><span>  \"</span><span style=\"color:#a3be8c;\">title</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\"\n</span><span>    ]\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">description</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\"\n</span><span>    ]\n</span><span>  }\n</span><span>...\n</span></code></pre>\n<p>OK! Let's rebuild and reindex. Here's the entire step all rolled into one copypasta-for-ya-kibana.</p>\n<p><em>Step 2: Suggest Words.</em></p>\n<p>Let's delete the old example to make way for the new:</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">DELETE </span><span style=\"color:#a3be8c;\">/autocomplete-example\n</span></code></pre>\n<p><em>Add the new one:</em></p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">PUT </span><span style=\"color:#a3be8c;\">/autocomplete-example/\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">mappings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">properties</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">docid</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\":          { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\"] },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">image</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">published</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">modified</span><span>\":     { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">author</span><span>\":       { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\":{ \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_depth</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">integer</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">description</span><span>\":  { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">body</span><span>\":         { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">term_vector</span><span>\": \"</span><span style=\"color:#a3be8c;\">with_positions_offsets</span><span>\"},\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\":   { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\", \"</span><span style=\"color:#a3be8c;\">fields</span><span>\": { \"</span><span style=\"color:#a3be8c;\">raw</span><span>\": { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" } } },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\": {\n</span><span>\t      \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>\t      \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\",\n</span><span>\t      \"</span><span style=\"color:#a3be8c;\">fielddata</span><span>\": </span><span style=\"color:#d08770;\">true\n</span><span>\t    }\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">settings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analysis</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stop</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">stopwords</span><span>\": \"</span><span style=\"color:#a3be8c;\">_english_</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">english</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">possessive_english</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">min_gram</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">max_gram</span><span>\": </span><span style=\"color:#d08770;\">25</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">token_chars</span><span>\": [\"</span><span style=\"color:#a3be8c;\">letter</span><span>\", \"</span><span style=\"color:#a3be8c;\">digit</span><span>\", \"</span><span style=\"color:#a3be8c;\">punctuation</span><span>\"]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\"\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\"\n</span><span>          ]\n</span><span>        }\n</span><span>\n</span><span>      }\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_shards</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_replicas</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">_reindex\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">bonsai</span><span>\"\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">dest</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\"\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>Query time. Same term \"ope\", and with the page hits (results) omitted for this example, but they are the same as in Step 1.</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">/autocomplete-example/_search\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">query</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">match</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope</span><span>\"\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggs</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_words</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">include</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope.*</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>      }\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">include</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\"\n</span><span>    ]\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">size</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>}\n</span></code></pre>\n<p>Some important details above: the <code>include</code> param for the <code>significant_terms</code> aggregation. We don't just want to show any\nterms! Without the <code>include</code> pattern, we'd get some weirdness (go ahead and try it for fun in your content).</p>\n<p>We are also setting <code>min_doc_count</code> to 1. This is because our corpus is tiny. If you have thousands or millions of\ndocuments, increase this number to improve performance.</p>\n<p>Let's see the results from the query:</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">took</span><span>\": </span><span style=\"color:#d08770;\">28</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">timed_out</span><span>\": </span><span style=\"color:#d08770;\">false</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_shards</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">successful</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">skipped</span><span>\": </span><span style=\"color:#d08770;\">0</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">failed</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">value</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">relation</span><span>\": \"</span><span style=\"color:#a3be8c;\">eq</span><span>\"\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_score</span><span>\": </span><span style=\"color:#d08770;\">null</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": []\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggregations</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_words</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">259</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">buckets</span><span>\": [\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">35</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.08947733871985859</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">35\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">operations</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">operational</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.0025564953919959593</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>        }\n</span><span>      ]\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>Do you love it? I think you love it. Let's keep going.</p>\n<h3 id=\"step-3-suggest-phrases\">Step 3: Suggest Phrases</h3>\n<p>You might look above and think \"hey, that's good enough.\" And that is totally fine. While writing this guide, I was in\nthe midst of doing everything, and I thought I might stop at <em>just</em> words.</p>\n<p>But, phrases are powerful. They show you combinations of things and, especially when you grow into millions of documents ripe\nfor discovery, they're far more useful than just single words to help narrow the search faster.</p>\n<p>What we need:</p>\n<ul>\n<li>A new field <code>suggest_phrase</code></li>\n<li>Less aggressive stemming (same as step 2)</li>\n<li><code>fielddata=true</code> (same as step 2)</li>\n<li>Shingles (in our case, <code>bigrams</code> and <code>trigrams</code>)</li>\n</ul>\n<p>What are shingles, <code>bigrams</code>, and <code>trigrams</code>? It's easier to just explain it. Let's use one of the titles above \"Compare Bonsai OpenSearch to AWS OpenSearch\" for an example.</p>\n<p><code>Bigram</code> shingles are all the possible two-word sequences:</p>\n<ul>\n<li>Compare Bonsai</li>\n<li>Bonsai OpenSearch</li>\n<li>OpenSearch to</li>\n<li>to AWS</li>\n<li>AWS OpenSearch</li>\n</ul>\n<p><code>Trigram</code> shingles are all the possible three-word sequences:</p>\n<ul>\n<li>Compare Bonsai OpenSearch</li>\n<li>Bonsai OpenSearch to</li>\n<li>OpenSearch to AWS</li>\n<li>to AWS OpenSearch</li>\n</ul>\n<p>After analysis (lowercase, stemming, stopword removal, shingling), we're left with the full list:</p>\n<ul>\n<li>compare bonsai</li>\n<li>compare bonsai opensearch</li>\n<li>bonsai opensearch</li>\n<li>bonsai opensearch _</li>\n<li>opensearch _</li>\n<li>opensearch _ aws</li>\n<li>_ aws</li>\n<li>_ aws opensearch</li>\n<li>aws opensearch</li>\n</ul>\n<p>The <code>_</code> denotes where stopwords are removed. This tells you, we're going to need some postprocessing once these\nsuggestions get returned. But that's really easy to do.</p>\n<p>Add this to your config:</p>\n<p><strong>Filter</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">bigrams_trigrams</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">shingle</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">min_shingle_size</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_shingle_size</span><span>\": </span><span style=\"color:#d08770;\">3</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">output_unigrams</span><span>\": </span><span style=\"color:#d08770;\">false\n</span><span>  }\n</span></code></pre>\n<p><strong>Analyzer</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">analyze_shingles</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"\n</span><span>    ],\n</span><span>    \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">bigrams_trigrams</span><span>\"\n</span><span>    ]\n</span><span>  }\n</span></code></pre>\n<p><strong>Field</strong></p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>  \"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_shingles</span><span>\",\n</span><span>    \"</span><span style=\"color:#a3be8c;\">fielddata</span><span>\": </span><span style=\"color:#d08770;\">true\n</span><span>  }\n</span></code></pre>\n<p>With those in place, add <code>suggest_phrase</code> to your <code>title</code> and <code>description</code> <code>copy_to</code>'s</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span style=\"color:#65737e;\">// ...\n</span><span>\"</span><span style=\"color:#a3be8c;\">title</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\"]},\n</span><span>\"</span><span style=\"color:#a3be8c;\">description</span><span>\":  { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\"]},\n</span><span style=\"color:#65737e;\">// ...\n</span></code></pre>\n<p>Our completed configuration, ladies, gentlemen, and everyone in between:</p>\n<p><em>Step 3: Suggest Phrases</em></p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#65737e;\"># Step 3: Suggest Phrases\n</span><span style=\"color:#b48ead;\">PUT </span><span style=\"color:#a3be8c;\">/autocomplete-example/\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">mappings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">properties</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">docid</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\":          { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\"] },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">image</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">published</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">modified</span><span>\":     { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">date</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">author</span><span>\":       { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_hierarchy</span><span>\":{ \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\"},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url_depth</span><span>\":    { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">integer</span><span>\" },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\":        { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">description</span><span>\":  { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">copy_to</span><span>\":[\"</span><span style=\"color:#a3be8c;\">completion</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">body</span><span>\":         { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\", \"</span><span style=\"color:#a3be8c;\">term_vector</span><span>\": \"</span><span style=\"color:#a3be8c;\">with_positions_offsets</span><span>\"},\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\":   { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\", \"</span><span style=\"color:#a3be8c;\">fields</span><span>\": { \"</span><span style=\"color:#a3be8c;\">raw</span><span>\": { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">keyword</span><span>\" } } },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\":   { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\",  \"</span><span style=\"color:#a3be8c;\">fielddata</span><span>\": </span><span style=\"color:#d08770;\">true</span><span>},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\": { \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">text</span><span>\", \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": \"</span><span style=\"color:#a3be8c;\">analyze_shingles</span><span>\",  \"</span><span style=\"color:#a3be8c;\">fielddata</span><span>\": </span><span style=\"color:#d08770;\">true</span><span>}\n</span><span>\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">settings</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">analysis</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stop</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">stopwords</span><span>\": \"</span><span style=\"color:#a3be8c;\">_english_</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">english</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">stemmer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">language</span><span>\": \"</span><span style=\"color:#a3be8c;\">possessive_english</span><span>\"\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">bigrams_trigrams</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">shingle</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">min_shingle_size</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">max_shingle_size</span><span>\": </span><span style=\"color:#d08770;\">3</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">output_unigrams</span><span>\": </span><span style=\"color:#d08770;\">false\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">min_gram</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">max_gram</span><span>\": </span><span style=\"color:#d08770;\">25</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">token_chars</span><span>\": [\"</span><span style=\"color:#a3be8c;\">letter</span><span>\", \"</span><span style=\"color:#a3be8c;\">digit</span><span>\", \"</span><span style=\"color:#a3be8c;\">punctuation</span><span>\"]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>\n</span><span>      \"</span><span style=\"color:#a3be8c;\">analyzer</span><span>\": {\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_urls</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">path_hierarchy_tokenizer</span><span>\"\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">edge_ngram_analyzer</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">edge_ngram_tokenizer</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_names</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stem</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_english_exactish</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_possessive_stem</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\"\n</span><span>          ]\n</span><span>        },\n</span><span>\n</span><span>        \"</span><span style=\"color:#a3be8c;\">analyze_shingles</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">type</span><span>\": \"</span><span style=\"color:#a3be8c;\">custom</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">char_filter</span><span>\": [\"</span><span style=\"color:#a3be8c;\">html_strip</span><span>\"],\n</span><span>          \"</span><span style=\"color:#a3be8c;\">tokenizer</span><span>\": \"</span><span style=\"color:#a3be8c;\">standard</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">filter</span><span>\": [\n</span><span>            \"</span><span style=\"color:#a3be8c;\">lowercase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">english_stop</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">bigrams_trigrams</span><span>\"\n</span><span>          ]\n</span><span>        }\n</span><span>\n</span><span>      }\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_shards</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">number_of_replicas</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>POST _reindex\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">bonsai</span><span>\"\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">dest</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\"\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p><strong>Query</strong></p>\n<p>We're just showing the phrase example here for now. It uses the same <code>significant_terms</code> agg technique, just on our new\n<code>suggest_phrase</code> field.</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">/autocomplete-example/_search\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">query</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">match</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope</span><span>\"\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggs</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_phrases</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">include</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope.*</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>      }\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">include</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\"\n</span><span>    ]\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">size</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>}\n</span></code></pre>\n<p>Results look good but they need some postprocessing. That's fine. I've yet to run into a complex case where at least\nsome middleware isn't required. After we put it all together, I'll give some examples in JavaScript (don't hate!)</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">took</span><span>\": </span><span style=\"color:#d08770;\">14</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">timed_out</span><span>\": </span><span style=\"color:#d08770;\">false</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_shards</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">successful</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">skipped</span><span>\": </span><span style=\"color:#d08770;\">0</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">failed</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">value</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">relation</span><span>\": \"</span><span style=\"color:#a3be8c;\">eq</span><span>\"\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_score</span><span>\": </span><span style=\"color:#d08770;\">null</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": []\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggregations</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_phrases</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">259</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">buckets</span><span>\": [\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">8</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.020451963135967675</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">8\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch bonsai</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">7</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.017895467743971716</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">7\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch platform _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch platform</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch _ solrcloud</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">3</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.007669486175987881</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">3\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open letter _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open letter</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch here _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch clusters</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch here</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        }\n</span><span>      ]\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<p>When you eventually postprocess, you'll be left with the following autocomplete phrases:</p>\n<ul>\n<li>opensearch bonsai</li>\n<li>opensearch platform</li>\n<li>opensearch solrcloud</li>\n<li>open letter</li>\n<li>opensearch here</li>\n<li>opensearch clusters</li>\n</ul>\n<p>These aren't amazing, but they're a good start,and in my opinion good enough to guide the user. Our example only has a\nsmall corpus to sample from and if we had lots more content these suggestions would improve. Give it a try on your\ncontent and see how it turns out!</p>\n<h3 id=\"our-final-query\">Our final query</h3>\n<p>No more scenery-chewing, here's the final completed query:</p>\n<pre data-lang=\"http-json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-http-json \"><code class=\"language-http-json\" data-lang=\"http-json\"><span style=\"color:#b48ead;\">POST </span><span style=\"color:#a3be8c;\">/autocomplete-example/_search\n</span><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">query</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">match</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope</span><span>\"\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggregations</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_words</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">include</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope.*</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>      }\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_phrases</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">include</span><span>\": \"</span><span style=\"color:#a3be8c;\">ope.*</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>      }\n</span><span>    }\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">include</span><span>\": [\n</span><span>      \"</span><span style=\"color:#a3be8c;\">title</span><span>\",\n</span><span>      \"</span><span style=\"color:#a3be8c;\">url</span><span>\"\n</span><span>    ]\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">size</span><span>\": </span><span style=\"color:#d08770;\">3\n</span><span>}\n</span></code></pre>\n<p>And the unprocessed results:</p>\n<pre data-lang=\"json\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-json \"><code class=\"language-json\" data-lang=\"json\"><span>{\n</span><span>  \"</span><span style=\"color:#a3be8c;\">took</span><span>\": </span><span style=\"color:#d08770;\">71</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">timed_out</span><span>\": </span><span style=\"color:#d08770;\">false</span><span>,\n</span><span>  \"</span><span style=\"color:#a3be8c;\">_shards</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">successful</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">skipped</span><span>\": </span><span style=\"color:#d08770;\">0</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">failed</span><span>\": </span><span style=\"color:#d08770;\">0\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">total</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">value</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">relation</span><span>\": \"</span><span style=\"color:#a3be8c;\">eq</span><span>\"\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">max_score</span><span>\": </span><span style=\"color:#d08770;\">6.6680512</span><span>,\n</span><span>    \"</span><span style=\"color:#a3be8c;\">hits</span><span>\": [\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">bfb9fe25-8742-1067-026a-428025c41672</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.6680512</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">Compare Bonsai OpenSearch to AWS OpenSearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/vs/amazon-opensearch-service</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">db637423-cf63-24c5-32ac-68c309c62fbe</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.501189</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">Up and Running with OpenSearch – Bonsai</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/blog/up-and-running-with-opensearch</span><span>\"\n</span><span>        }\n</span><span>      },\n</span><span>      {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_index</span><span>\": \"</span><span style=\"color:#a3be8c;\">autocomplete-example</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_id</span><span>\": \"</span><span style=\"color:#a3be8c;\">9a160271-5f4b-fc7f-1215-fdf63f2d9cc3</span><span>\",\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_score</span><span>\": </span><span style=\"color:#d08770;\">6.486245</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">title</span><span>\": \"</span><span style=\"color:#a3be8c;\">OpenSearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">url</span><span>\": \"</span><span style=\"color:#a3be8c;\">https://bonsai.io/category/opensearch</span><span>\"\n</span><span>        }\n</span><span>      }\n</span><span>    ]\n</span><span>  },\n</span><span>  \"</span><span style=\"color:#a3be8c;\">aggregations</span><span>\": {\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_words</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">259</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">buckets</span><span>\": [\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">35</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.08947733871985859</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">35\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">operations</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">operational</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">1</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.0025564953919959593</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>        }\n</span><span>      ]\n</span><span>    },\n</span><span>    \"</span><span style=\"color:#a3be8c;\">significant_phrases</span><span>\": {\n</span><span>      \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">178</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">259</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">buckets</span><span>\": [\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">8</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.020451963135967675</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">8\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch bonsai</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">7</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.017895467743971716</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">7\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch platform _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch platform</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">4</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.010225981567983837</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">4\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch _ solrcloud</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">3</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.007669486175987881</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">3\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open letter _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">open letter</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch here _</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch clusters</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        },\n</span><span>        {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">key</span><span>\": \"</span><span style=\"color:#a3be8c;\">opensearch here</span><span>\",\n</span><span>          \"</span><span style=\"color:#a3be8c;\">doc_count</span><span>\": </span><span style=\"color:#d08770;\">2</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">score</span><span>\": </span><span style=\"color:#d08770;\">0.005112990783991919</span><span>,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">bg_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>        }\n</span><span>      ]\n</span><span>    }\n</span><span>  }\n</span><span>}\n</span></code></pre>\n<h2 id=\"performance\">Performance</h2>\n<p>One thing we didn't talk about yet, was speed. This is fast. I aim for less than 50ms. I'll take 70. Get worried when\nyou start hitting 250 - the user would notice a lag and that's no fun. This is fast at query time because we're\ndoing a lot up-front at index time. When things start getting slow, do the following, in this order:</p>\n<ol>\n<li><a href=\"https://bonsai.io/contact\">Talk to us at Bonsai</a> and we'll make it fast for you.</li>\n</ol>\n<h2 id=\"post-processing\">Post-Processing</h2>\n<p>For post, here's what we need to do. On the browser I'm\nusing <a href=\"https://tarekraafat.github.io/autoComplete.js\">autocomplete.js</a> somewhere in the middle of the browser and the\nsearch engine I need to handle requests and post-process the get all this in a single list. In theory, you could\nimplement this all on the client side, but I want the browser implementation to be minimal.</p>\n<p>Here are the steps I need for post-processing:</p>\n<ol>\n<li>Transform the hits into <code>{ label, value }</code> objects</li>\n<li>Clean and transform the <code>significant_words</code> agg bucket into <code>{ label, value }</code> objects</li>\n<li>Clean and transform the <code>significant_phrases</code> agg bucket into <code>{ label, value }</code> objects</li>\n</ol>\n<p>I'm not going to get into front-end design like CSS or icons, so for now I'll just use some emoji 😈</p>\n<p>This is the full implementation. I'm sorry for the wall of code.</p>\n<pre data-lang=\"javascript\" style=\"background-color:#2b303b;color:#c0c5ce;\" class=\"language-javascript \"><code class=\"language-javascript\" data-lang=\"javascript\"><span style=\"color:#b48ead;\">import </span><span>{ </span><span style=\"color:#bf616a;\">Client </span><span>} </span><span style=\"color:#b48ead;\">from </span><span>'</span><span style=\"color:#a3be8c;\">@opensearch-project/opensearch</span><span>'; </span><span style=\"color:#65737e;\">// You can use Elastic too!\n</span><span>\n</span><span style=\"color:#b48ead;\">import </span><span style=\"color:#bf616a;\">pLimit </span><span style=\"color:#b48ead;\">from </span><span>'</span><span style=\"color:#a3be8c;\">p-limit</span><span>'; </span><span style=\"color:#65737e;\">// requires `npm i p-limit`\n</span><span>\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">client </span><span>= new Client({\"</span><span style=\"color:#a3be8c;\">node</span><span>\": process.env.</span><span style=\"color:#bf616a;\">BONSAI_URL</span><span>}); </span><span style=\"color:#65737e;\">// Point this at your search cluster\n</span><span>\n</span><span style=\"color:#65737e;\">/*\n</span><span style=\"color:#65737e;\">    Make our autocomplete query\n</span><span style=\"color:#65737e;\">*/\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#8fa1b3;\">getAutocompleteQuery </span><span>= </span><span style=\"color:#b48ead;\">function</span><span>(</span><span style=\"color:#bf616a;\">querystring</span><span>,</span><span style=\"color:#bf616a;\">k</span><span>) {\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">pattern </span><span>= `</span><span style=\"color:#a3be8c;\">${</span><span style=\"color:#bf616a;\">querystring</span><span style=\"color:#a3be8c;\">}.*</span><span>`\n</span><span>  </span><span style=\"color:#b48ead;\">return </span><span>{\n</span><span>      \"</span><span style=\"color:#a3be8c;\">query</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">match</span><span>\": { \"</span><span style=\"color:#a3be8c;\">completion</span><span>\": </span><span style=\"color:#bf616a;\">querystring </span><span>}\n</span><span>      },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">aggregations</span><span>\": {\n</span><span>        \"</span><span style=\"color:#a3be8c;\">significant_words</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>            \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_word</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">include</span><span>\": </span><span style=\"color:#bf616a;\">pattern</span><span>,\n</span><span>            \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">2\n</span><span>          }\n</span><span>        },\n</span><span>        \"</span><span style=\"color:#a3be8c;\">significant_phrases</span><span>\": {\n</span><span>          \"</span><span style=\"color:#a3be8c;\">significant_terms</span><span>\": {\n</span><span>            \"</span><span style=\"color:#a3be8c;\">field</span><span>\": \"</span><span style=\"color:#a3be8c;\">suggest_phrase</span><span>\",\n</span><span>            \"</span><span style=\"color:#a3be8c;\">include</span><span>\": </span><span style=\"color:#bf616a;\">pattern</span><span>,\n</span><span>            \"</span><span style=\"color:#a3be8c;\">min_doc_count</span><span>\": </span><span style=\"color:#d08770;\">1\n</span><span>          }\n</span><span>        }\n</span><span>      },\n</span><span>      \"</span><span style=\"color:#a3be8c;\">_source</span><span>\": {\"</span><span style=\"color:#a3be8c;\">include</span><span>\":[\"</span><span style=\"color:#a3be8c;\">title</span><span>\",\"</span><span style=\"color:#a3be8c;\">url</span><span>\"]},\n</span><span>      \"</span><span style=\"color:#a3be8c;\">size</span><span>\": </span><span style=\"color:#bf616a;\">k</span><span>||</span><span style=\"color:#d08770;\">3\n</span><span>  }\n</span><span>}\n</span><span>\n</span><span style=\"color:#65737e;\">/*\n</span><span style=\"color:#65737e;\">    This uses the Analyzer on the server to normalize each suggested term!\n</span><span style=\"color:#65737e;\">    We do this with concurrency to keep it fast\n</span><span style=\"color:#65737e;\">*/\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#8fa1b3;\">normalizeAutocomplete </span><span>= </span><span style=\"color:#b48ead;\">async function</span><span>(</span><span style=\"color:#bf616a;\">collection</span><span>,</span><span style=\"color:#bf616a;\">texts</span><span>,</span><span style=\"color:#bf616a;\">concurrent</span><span>) {\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">limit </span><span>= </span><span style=\"color:#8fa1b3;\">pLimit</span><span>(</span><span style=\"color:#bf616a;\">concurrent</span><span>||</span><span style=\"color:#d08770;\">10</span><span>);\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">tasks </span><span>= </span><span style=\"color:#bf616a;\">texts</span><span>.</span><span style=\"color:#8fa1b3;\">map</span><span>(</span><span style=\"color:#bf616a;\">text </span><span style=\"color:#b48ead;\">=&gt;\n</span><span>    </span><span style=\"color:#8fa1b3;\">limit</span><span>(</span><span style=\"color:#b48ead;\">async </span><span>() </span><span style=\"color:#b48ead;\">=&gt; </span><span>{\n</span><span>      </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">res </span><span>= </span><span style=\"color:#b48ead;\">await </span><span style=\"color:#bf616a;\">client</span><span>.</span><span style=\"color:#bf616a;\">indices</span><span>.</span><span style=\"color:#8fa1b3;\">analyze</span><span>({\n</span><span>        index:</span><span style=\"color:#bf616a;\">collection</span><span>,\n</span><span>        body: {\n</span><span>          analyzer:\"</span><span style=\"color:#a3be8c;\">analyze_english</span><span>\",\n</span><span>          text:</span><span style=\"color:#bf616a;\">text</span><span>.</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">[_]</span><span>/</span><span style=\"color:#b48ead;\">g</span><span>,' ').</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">\\s</span><span>+/,' ').</span><span style=\"color:#8fa1b3;\">trim</span><span>()\n</span><span>        }\n</span><span>      });\n</span><span>\n</span><span>      </span><span style=\"color:#b48ead;\">return </span><span>{\n</span><span>        q: </span><span style=\"color:#bf616a;\">text</span><span>,\n</span><span>        norm: </span><span style=\"color:#bf616a;\">res</span><span>.body.</span><span style=\"color:#bf616a;\">tokens</span><span>.</span><span style=\"color:#8fa1b3;\">map</span><span>(</span><span style=\"color:#bf616a;\">t </span><span style=\"color:#b48ead;\">=&gt; </span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">token</span><span>).</span><span style=\"color:#96b5b4;\">join</span><span>('</span><span style=\"color:#a3be8c;\">_</span><span>')\n</span><span>      };\n</span><span>    })\n</span><span>  );\n</span><span>\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">results </span><span>= </span><span style=\"color:#b48ead;\">await </span><span style=\"color:#ebcb8b;\">Promise</span><span>.</span><span style=\"color:#96b5b4;\">all</span><span>(</span><span style=\"color:#bf616a;\">tasks</span><span>);\n</span><span>  </span><span style=\"color:#b48ead;\">return </span><span style=\"color:#bf616a;\">results</span><span>;\n</span><span>};\n</span><span>\n</span><span style=\"color:#65737e;\">/*\n</span><span style=\"color:#65737e;\">    This is what your route will call, passing in the collection (index name), querystring prefix, and k page results\n</span><span style=\"color:#65737e;\">*/\n</span><span style=\"color:#b48ead;\">export const </span><span style=\"color:#8fa1b3;\">autocomplete </span><span>= </span><span style=\"color:#b48ead;\">async function</span><span>(</span><span style=\"color:#bf616a;\">collection</span><span>,</span><span style=\"color:#bf616a;\">querystring</span><span>,</span><span style=\"color:#bf616a;\">k</span><span>) {\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">body </span><span>= </span><span style=\"color:#8fa1b3;\">getAutocompleteQuery</span><span>(</span><span style=\"color:#bf616a;\">querystring</span><span>,</span><span style=\"color:#bf616a;\">k</span><span>);\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">results </span><span>= </span><span style=\"color:#b48ead;\">await </span><span style=\"color:#bf616a;\">client</span><span>.</span><span style=\"color:#96b5b4;\">search</span><span>({\n</span><span>    index: </span><span style=\"color:#bf616a;\">collection</span><span>,\n</span><span>    body: </span><span style=\"color:#bf616a;\">body\n</span><span>  });\n</span><span>\n</span><span>  </span><span style=\"color:#65737e;\">//Keep track of everything\n</span><span>  </span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">texts </span><span>= [];\n</span><span>  </span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">seen </span><span>= [];\n</span><span>  </span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">resp </span><span>= {\n</span><span>    titles:[],\n</span><span>    terms:[]\n</span><span>  }\n</span><span>\n</span><span>  </span><span style=\"color:#65737e;\">// Post-processor for normalized word and phrase suggestions\n</span><span>  </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#8fa1b3;\">term </span><span>= </span><span style=\"color:#b48ead;\">function</span><span>(</span><span style=\"color:#bf616a;\">t</span><span>) {\n</span><span>    </span><span style=\"color:#b48ead;\">if</span><span>(!</span><span style=\"color:#bf616a;\">t </span><span>|| !</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">q </span><span>|| !</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">q</span><span>.length || !</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">norm </span><span>|| !</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">norm</span><span>.length) </span><span style=\"color:#b48ead;\">return</span><span>;\n</span><span>    </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">q </span><span>= </span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">q</span><span>.</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">[_]</span><span>/</span><span style=\"color:#b48ead;\">g</span><span>,' ').</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">\\s</span><span>+/,' ').</span><span style=\"color:#8fa1b3;\">trim</span><span>();\n</span><span>    </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">n </span><span>= </span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">norm</span><span>.</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">[_]</span><span>/</span><span style=\"color:#b48ead;\">g</span><span>,' ').</span><span style=\"color:#96b5b4;\">replace</span><span>(/</span><span style=\"color:#d08770;\">\\s</span><span>+/,' ').</span><span style=\"color:#8fa1b3;\">trim</span><span>();\n</span><span>    </span><span style=\"color:#b48ead;\">if</span><span>(</span><span style=\"color:#bf616a;\">seen</span><span>.</span><span style=\"color:#96b5b4;\">indexOf</span><span>(</span><span style=\"color:#bf616a;\">n</span><span>)&lt;</span><span style=\"color:#d08770;\">0</span><span>) {\n</span><span>      </span><span style=\"color:#bf616a;\">seen</span><span>.</span><span style=\"color:#96b5b4;\">push</span><span>(</span><span style=\"color:#bf616a;\">n</span><span>);\n</span><span>      </span><span style=\"color:#bf616a;\">resp</span><span>.</span><span style=\"color:#bf616a;\">terms</span><span>.</span><span style=\"color:#96b5b4;\">push</span><span>({\n</span><span>        \"</span><span style=\"color:#a3be8c;\">label</span><span>\":'</span><span style=\"color:#a3be8c;\">🔍 </span><span>' + </span><span style=\"color:#bf616a;\">q</span><span>,\n</span><span>        \"</span><span style=\"color:#a3be8c;\">value</span><span>\":`</span><span style=\"color:#a3be8c;\">/sites/${</span><span style=\"color:#bf616a;\">collection</span><span style=\"color:#a3be8c;\">}/search?q=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">q</span><span style=\"color:#a3be8c;\">)}&amp;s=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">querystring</span><span style=\"color:#a3be8c;\">)}&amp;p=${</span><span style=\"color:#bf616a;\">resp</span><span style=\"color:#a3be8c;\">.</span><span style=\"color:#bf616a;\">terms</span><span style=\"color:#a3be8c;\">.length}</span><span>`\n</span><span>      });\n</span><span>    }\n</span><span>  };\n</span><span>\n</span><span>  </span><span style=\"color:#65737e;\">// Transform Opensearch response into the \"resp\" object\n</span><span>  </span><span style=\"color:#b48ead;\">if</span><span>(</span><span style=\"color:#bf616a;\">results </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">results</span><span>.body) {\n</span><span>    </span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">b </span><span>= </span><span style=\"color:#bf616a;\">results</span><span>.body;\n</span><span>\n</span><span>    </span><span style=\"color:#65737e;\">// Document hits, add to resp.titles\n</span><span>    </span><span style=\"color:#b48ead;\">if</span><span>(</span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">hits </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">hits</span><span>.</span><span style=\"color:#bf616a;\">hits</span><span>) {\n</span><span>      </span><span style=\"color:#bf616a;\">resp</span><span>.</span><span style=\"color:#bf616a;\">titles </span><span>= </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">hits</span><span>.</span><span style=\"color:#bf616a;\">hits</span><span>.</span><span style=\"color:#8fa1b3;\">map</span><span>((</span><span style=\"color:#bf616a;\">r</span><span>,</span><span style=\"color:#bf616a;\">i</span><span>)</span><span style=\"color:#b48ead;\">=&gt;</span><span>{\n</span><span>        </span><span style=\"color:#b48ead;\">return </span><span>{\n</span><span>          \"</span><span style=\"color:#a3be8c;\">label</span><span>\":'</span><span style=\"color:#a3be8c;\">🔖 </span><span>' + </span><span style=\"color:#bf616a;\">r</span><span>.</span><span style=\"color:#bf616a;\">_source</span><span>.title,\n</span><span>          \"</span><span style=\"color:#a3be8c;\">value</span><span>\":`</span><span style=\"color:#a3be8c;\">/sites/${</span><span style=\"color:#bf616a;\">collection</span><span style=\"color:#a3be8c;\">}/redirect?u=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">r</span><span style=\"color:#a3be8c;\">.</span><span style=\"color:#bf616a;\">_source</span><span style=\"color:#a3be8c;\">.</span><span style=\"color:#bf616a;\">url</span><span style=\"color:#a3be8c;\">)}&amp;s=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">querystring</span><span style=\"color:#a3be8c;\">)}&amp;p=${</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#a3be8c;\">}</span><span>`\n</span><span>        }\n</span><span>      });\n</span><span>    }\n</span><span>\n</span><span>    </span><span style=\"color:#65737e;\">// Word suggestions\n</span><span>    </span><span style=\"color:#b48ead;\">if</span><span>(</span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_words </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_words</span><span>.</span><span style=\"color:#bf616a;\">buckets</span><span>) {\n</span><span>      </span><span style=\"color:#bf616a;\">texts </span><span>= </span><span style=\"color:#bf616a;\">texts</span><span>.</span><span style=\"color:#96b5b4;\">concat</span><span>(</span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_words</span><span>.</span><span style=\"color:#bf616a;\">buckets</span><span>.</span><span style=\"color:#8fa1b3;\">map</span><span>(</span><span style=\"color:#bf616a;\">t</span><span style=\"color:#b48ead;\">=&gt;</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">key</span><span>)).</span><span style=\"color:#8fa1b3;\">filter</span><span>(</span><span style=\"color:#bf616a;\">v</span><span style=\"color:#b48ead;\">=&gt;</span><span style=\"color:#bf616a;\">v</span><span>&amp;&amp;</span><span style=\"color:#bf616a;\">v</span><span>.length);\n</span><span>    }\n</span><span>\n</span><span>    </span><span style=\"color:#65737e;\">// Phrase suggestions\n</span><span>    </span><span style=\"color:#b48ead;\">if</span><span>(</span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_phrases </span><span>&amp;&amp; </span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_phrases</span><span>.</span><span style=\"color:#bf616a;\">buckets</span><span>) {\n</span><span>      </span><span style=\"color:#bf616a;\">texts </span><span>= </span><span style=\"color:#bf616a;\">texts</span><span>.</span><span style=\"color:#96b5b4;\">concat</span><span>(</span><span style=\"color:#bf616a;\">b</span><span>.</span><span style=\"color:#bf616a;\">aggregations</span><span>.</span><span style=\"color:#bf616a;\">significant_phrases</span><span>.</span><span style=\"color:#bf616a;\">buckets</span><span>.</span><span style=\"color:#8fa1b3;\">map</span><span>(</span><span style=\"color:#bf616a;\">t</span><span style=\"color:#b48ead;\">=&gt;</span><span style=\"color:#bf616a;\">t</span><span>.</span><span style=\"color:#bf616a;\">key</span><span>)).</span><span style=\"color:#8fa1b3;\">filter</span><span>(</span><span style=\"color:#bf616a;\">v</span><span style=\"color:#b48ead;\">=&gt;</span><span style=\"color:#bf616a;\">v</span><span>&amp;&amp;</span><span style=\"color:#bf616a;\">v</span><span>.length);\n</span><span>    }\n</span><span>\n</span><span>    </span><span style=\"color:#65737e;\">// Normalize and collapse the suggested search terms\n</span><span>    </span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">norms </span><span>= </span><span style=\"color:#b48ead;\">await </span><span style=\"color:#8fa1b3;\">normalizeAutocomplete</span><span>(</span><span style=\"color:#bf616a;\">collection</span><span>,</span><span style=\"color:#bf616a;\">texts</span><span>,</span><span style=\"color:#d08770;\">20</span><span>);\n</span><span>    </span><span style=\"color:#bf616a;\">norms</span><span>.</span><span style=\"color:#96b5b4;\">forEach</span><span>(</span><span style=\"color:#bf616a;\">term</span><span>)\n</span><span>\n</span><span>  }\n</span><span>\n</span><span>  </span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">auto </span><span>= [{\n</span><span>      \"</span><span style=\"color:#a3be8c;\">label</span><span>\":'</span><span style=\"color:#a3be8c;\">🔍 </span><span>' + </span><span style=\"color:#bf616a;\">querystring</span><span>,\n</span><span>      \"</span><span style=\"color:#a3be8c;\">value</span><span>\":`</span><span style=\"color:#a3be8c;\">/sites/${</span><span style=\"color:#bf616a;\">collection</span><span style=\"color:#a3be8c;\">}/search?q=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">querystring</span><span style=\"color:#a3be8c;\">)}&amp;s=${</span><span style=\"color:#96b5b4;\">encodeURIComponent</span><span style=\"color:#a3be8c;\">(</span><span style=\"color:#bf616a;\">querystring</span><span style=\"color:#a3be8c;\">)}&amp;p=0</span><span>`\n</span><span>    }]\n</span><span>    .</span><span style=\"color:#96b5b4;\">concat</span><span>(</span><span style=\"color:#bf616a;\">resp</span><span>.</span><span style=\"color:#bf616a;\">titles</span><span>)\n</span><span>    .</span><span style=\"color:#96b5b4;\">concat</span><span>(</span><span style=\"color:#bf616a;\">resp</span><span>.</span><span style=\"color:#bf616a;\">terms</span><span>);\n</span><span>\n</span><span>  </span><span style=\"color:#b48ead;\">return </span><span style=\"color:#bf616a;\">auto</span><span>;\n</span><span>}\n</span><span>\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">Autocomplete </span><span>= { </span><span style=\"color:#bf616a;\">autocomplete </span><span>};\n</span><span style=\"color:#b48ead;\">export default </span><span style=\"color:#bf616a;\">Autocomplete</span><span>;\n</span></code></pre>\n<p>OK! That was a lot. Let's admire the majesty of our completed solution</p>\n\n    <center-l data-i=\"Center-var(--measure)falsefalse\">\n        <box-l data-i=\"Box-var(--s1)0blackfalse\">\n            <frame-l ratio=\"2158:918\" data-i=\"Frame-2158:918\"><img src=\"https://bonsai.io/blog/how-to-really-do-autocomplete/image-3.png?h=CZjUY02PZWARwsWJ7//wvkMT1qtWj3UY5tVL573F450=\" alt=\"Completed example searching the `ope` prefix\">\n            </frame-l>\n        </box-l>\n    </center-l>\n\n    <center-l data-i=\"Center-var(--measure)falsefalse\">\n        <box-l data-i=\"Box-var(--s1)0blackfalse\">\n            <frame-l ratio=\"2158:1044\" data-i=\"Frame-2158:1044\"><img src=\"https://bonsai.io/blog/how-to-really-do-autocomplete/image-4.png?h=s5DVB81EhMCcX1p6/HdU5zDMLkj01bUbuCiAUGOZ+pU=\" alt=\"Completed example searching the `pri` prefix\">\n            </frame-l>\n        </box-l>\n    </center-l>\n<p>It's beautiful! I literally cried tears of joy.</p>\n<p>See you next time!</p>\n<h1 id=\"further-reading\">Further Reading</h1>\n<p><a href=\"https://staff.fnwi.uva.nl/m.derijke/wp-content/papercite-data/pdf/cai-phd-thesis-2016.pdf\">https://staff.fnwi.uva.nl/m.derijke/wp-content/papercite-data/pdf/cai-phd-thesis-2016.pdf</a></p>\n\n\n                        <div class=\"blog-cta\" id=\"on-page-cta-form\">\n            <sidebar-l contentmin=\"33%\" sidewidth=\"48ch\" data-i=\"Sidebar-left48ch33%var(--s1)\">\n                <cover-l centered=\"box-l\" minheight=\"100%\" nopad=\"true\" data-i=\"Cover-box-lvar(--s1)100%true\">\n                    <box-l padding=\"var(--s3)\" data-i=\"Box-var(--s3)0blackfalse\">\n                        <stack-l data-i=\"Stack-var(--s1)false\">\n\n                            <h2 style=\"font-size: var(--font-size-7xl)\">Ready to take a closer look at Bonsai?</h2>\n                            <p>Find out if Bonsai is a good fit for you in just 15 minutes.</p>\n\n                            <div class=\"call-learnings\">\n\n                                \n                                <div class=\"learning\">\n                                    <svg id=\"hex-icon-check\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 21\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                        <path d=\"M17.9186 0H5.97578L0 10.3643L5.97578 20.7197H17.9186L23.8856 10.3643L17.9186 0Z\" fill=\"#787DF7\"></path>\n                                        <path d=\"M8 11.1034L10.6047 14L16 8\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n                                    </svg>\n\n                                    <p>\n                                        Learn how a managed service works and why it’s valuable to dev teams\n                                    </p>\n                                </div>\n\n                                \n                                <div class=\"learning\">\n                                    <svg id=\"hex-icon-check\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 21\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                        <path d=\"M17.9186 0H5.97578L0 10.3643L5.97578 20.7197H17.9186L23.8856 10.3643L17.9186 0Z\" fill=\"#787DF7\"></path>\n                                        <path d=\"M8 11.1034L10.6047 14L16 8\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n                                    </svg>\n\n                                    <p>\n                                        You won’t be pressured or used in any manipulative sales tactics\n                                    </p>\n                                </div>\n\n                                \n                                <div class=\"learning\">\n                                    <svg id=\"hex-icon-check\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 21\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                        <path d=\"M17.9186 0H5.97578L0 10.3643L5.97578 20.7197H17.9186L23.8856 10.3643L17.9186 0Z\" fill=\"#787DF7\"></path>\n                                        <path d=\"M8 11.1034L10.6047 14L16 8\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n                                    </svg>\n\n                                    <p>\n                                        We’ll get a deep understanding of your current tech stack and needs\n                                    </p>\n                                </div>\n\n                                \n                                <div class=\"learning\">\n                                    <svg id=\"hex-icon-check\" preserveAspectRatio=\"xMidYMid meet\" viewBox=\"0 0 24 21\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                        <path d=\"M17.9186 0H5.97578L0 10.3643L5.97578 20.7197H17.9186L23.8856 10.3643L17.9186 0Z\" fill=\"#787DF7\"></path>\n                                        <path d=\"M8 11.1034L10.6047 14L16 8\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n                                    </svg>\n\n                                    <p>\n                                        Get all the information you need to decide to continue exploring Bonsai services\n                                    </p>\n                                </div>\n                            </div>\n                        </stack-l>\n                    </box-l>\n\n                </cover-l>\n                <box-l padding=\"var(--s3)\" data-i=\"Box-var(--s3)0blackfalse\">\n                    <script charset=\"utf-8\" type=\"text/javascript\" src=\"//js.hsforms.net/forms/embed/v2.js\"></script>\n                    <script data-hubspot-rendered=\"true\">\n                        hbspt.forms.create({\n                            portalId: \"40223002\",\n                            formId: \"36447181-ffc5-4f0a-840b-08a74acef3ac\",\n                            region: \"na1\"\n                        });\n                    </script><div id=\"hbspt-form-e6570569-6bd8-4fc1-8e48-24dd51b69d9f\" class=\"hbspt-form\" data-hs-forms-root=\"true\"></div>\n                </box-l>\n            </sidebar-l>\n        </div>\n                    </stack-l>\n                </center-l>\n            </main>\n\n            \n                    \n                    \n                        \n                            \n                            \n                            \n                        \n                        \n                    \n                    \n                    <nav class=\"article-navigation\">\n                        <box-l padding=\"var(--s5)\" class=\"pad-tb-only\" data-i=\"Box-var(--s5)0blackfalse\">\n                            <center-l max=\"var(--article-body-measure)\" data-i=\"Center-var(--article-body-measure)falsefalse\">\n                                <switcher-l threshold=\"40rem\" space=\"var(--s1)\" data-i=\"Switcher-40remvar(--s1)5\">\n\n                                    <div class=\"left\"><sidebar-l contentmin=\"50%\" space=\"var(--s1)\" data-i=\"Sidebar-left50%var(--s1)\">\n                                                <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"66px\" height=\"66px\" viewBox=\"0 0 66 66\"><title>\n                                                        icon/circles</title>\n                                                    <g id=\"Pages\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n                                                        <g id=\"Blog-Post-HD\" transform=\"translate(-273.000000, -4642.000000)\">\n                                                            <g id=\"next-post\" transform=\"translate(274.000000, 4627.000000)\">\n                                                                <g id=\"icon/circles\" transform=\"translate(0.000000, 16.000000)\">\n                                                                    <path d=\"M32,0 L32,0 C20.567,0 10.003,6.1 4.287,16 C-1.429,25.9 -1.429,38.1 4.287,48 C10.003,57.9 20.567,64 32,64 C43.433,64 53.997,57.9 59.713,48 C65.429,38.1 65.429,25.9 59.713,16 C53.997,6.1 43.433,0 32,0 Z\" id=\"Stroke-1\" stroke=\"#9CD4B6\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-dasharray=\"1,6\"></path>\n                                                                    <path d=\"M32,8 L32,8 C23.426,8 15.502,12.574 11.215,20 C6.928,27.426 6.928,36.574 11.215,44 C15.502,51.426 23.426,56 32,56 C40.574,56 48.498,51.426 52.785,44 C57.072,36.574 57.072,27.426 52.785,20 C48.498,12.574 40.574,8 32,8 Z\" id=\"Stroke-3\" stroke=\"#53866A\" stroke-width=\"2\"></path>\n                                                                    <path d=\"M40,32 C40,27.582 36.418,24 32,24 C27.582,24 24,27.582 24,32 C24,36.418 27.582,40 32,40 C36.418,40 40,36.418 40,32\" id=\"Fill-5\" fill=\"#59B27D\"></path>\n                                                                </g>\n                                                            </g>\n                                                        </g>\n                                                    </g>\n                                                </svg>\n\n                                                <stack-l space=\"0\" data-i=\"Stack-0false\">\n                                                    <a href=\"https://bonsai.io/https://bonsai.io/blog/elasticsearch-opensearch-query-sampling-relevancy/\" aria-label=\"Previous post\" aria-describedby=\"left_title\">\n                                                        <icon-l space=\"0\" class=\"with-icon\" data-i=\"Icon-0\">\n                                                            <svg class=\"\" height=\"12px\" width=\"12px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 12 12\" transform=\"(0, 1)\">\n                                                                <path fill=\"none\" stroke=\"currentColor\" fill-rule=\"evenodd\" d=\"M8 2l-4 4 4 4\"></path>\n                                                            </svg>\n                                                            <div class=\"text\">Previous post</div>\n                                                        </icon-l>\n                                                    </a>\n                                                    <p aria-hidden=\"true\" id=\"left_title\">\n                                                        <a href=\"https://bonsai.io/https://bonsai.io/blog/elasticsearch-opensearch-query-sampling-relevancy/\" aria-label=\"Previous post\" aria-describedby=\"left_title\" style=\"color: var(--font-color); font-style: italic;\">\n                                                            Query Sampling for Relevancy Testing\n                                                        </a>\n                                                    </p>\n                                                </stack-l>\n\n                                            </sidebar-l></div>\n\n                                    <div class=\"right\"></div>\n\n                                </switcher-l>\n                            </center-l>\n                        </box-l>\n                    </nav></stack-l>\n    </div>\n    \n    \n\n\n        </div>\n\n    </stack-l><div class=\"cta-illustration\">\n    <img class=\"img-full\" src=\"https://bonsai.io/static-assets/img/cta-waves-illustration.svg?h=huLl6hTGzmy7xpPiJsULCe4nTNbaWErvLOFDfwTCg5w=\" alt=\"Calming Bonsai waves\">\n</div><footer>\n    <center-l max=\"var(--body-measure)\" data-i=\"Center-var(--body-measure)falsefalse\">\n        <div class=\"footer-content\">\n            <stack-l data-i=\"Stack-var(--s1)false\">\n                <!-- Main content with sidebar layout -->\n                <sidebar-l sidewidth=\"42ch\" space=\"var(--s7)\" data-i=\"Sidebar-left42ch50%var(--s7)\">\n                    <!-- Left/top sidebar content -->\n                    <stack-l space=\"var(--s3)\" data-i=\"Stack-var(--s3)false\">\n                        <h2>One More Cloud</h2>\n                        <p>The search experts. Makers of <a href=\"/\">Bonsai</a>\n                            and <a href=\"https://www.websolr.com/\">Websolr</a>.\n                        </p>\n\n                        <!-- Social links -->\n                        <cluster-l class=\"social-links\" align=\"center\" data-i=\"Cluster-flex-startcentervar(--s1)\">\n\n                            <div class=\"footer-social\">\n                                <center-l data-i=\"Center-var(--measure)falsefalse\">\n                                    <div>\n                                        <cover-l space=\"0\" minheight=\"100%;\" nopad=\"true\" centered=\"a\" data-i=\"Cover-a0100%;true\">\n                                            <a href=\"https://twitter.com/bonsaisearch\">\n                                                <svg width=\"17\" height=\"14\" viewBox=\"0 0 17 14\" fill=\"currentColor\">\n                                                    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16.89 2.4802C16.3 2.7402 15.67 2.9202 15 3.0002C15.68 2.5902 16.2 1.9502 16.44 1.1902C15.81 1.5702 15.1 1.8402 14.36 1.9902C13.76 1.3502 12.91 0.950195 11.96 0.950195C10.15 0.950195 8.68001 2.4202 8.68001 4.2302C8.68001 4.4902 8.71 4.7402 8.76 4.9802C6.03 4.84019 3.61 3.5402 1.99 1.5502C1.71 2.0302 1.55 2.6002 1.55 3.2002C1.55 4.3402 2.13001 5.3402 3.01 5.9302C2.47001 5.9102 1.97001 5.7702 1.52001 5.5202C1.52001 5.5302 1.52001 5.5502 1.52001 5.5602C1.52001 7.1502 2.65 8.4802 4.15 8.7802C3.87 8.8502 3.58 8.89019 3.29 8.89019C3.08 8.89019 2.87 8.8702 2.67 8.8302C3.09 10.1302 4.3 11.0802 5.74 11.1102C4.62 11.9902 3.2 12.5202 1.66 12.5202C1.39 12.5202 1.13 12.5002 0.880005 12.4702C2.33 13.4002 4.06 13.9402 5.91 13.9402C11.95 13.9402 15.25 8.9402 15.25 4.6002C15.25 4.4602 15.25 4.3202 15.24 4.1802C15.88 3.7202 16.44 3.1402 16.88 2.4802H16.89Z\"></path>\n                                                </svg>\n                                            </a>\n                                        </cover-l>\n                                    </div>\n                                </center-l>\n                            </div>\n\n                            <div class=\"footer-social\">\n                                <center-l data-i=\"Center-var(--measure)falsefalse\">\n                                    <div>\n                                        <cover-l space=\"0\" minheight=\"100%;\" nopad=\"true\" centered=\"a\" data-i=\"Cover-a0100%;true\">\n                                            <a href=\"https://github.com/omc\">\n                                                <svg width=\"17\" height=\"17\" viewBox=\"0 0 15 20\" fill=\"currentColor\">\n                                                    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4.73001 19.7999C5.00001 19.5999 5.31001 19.3599 5.31001 18.9599C5.31001 18.3399 5.30001 16.7399 5.30001 16.7399C5.30001 16.7399 4.81001 16.8199 4.11001 16.8199C2.35001 16.8199 1.79001 15.6999 1.52001 15.0699C1.17001 14.2499 0.730011 13.8699 0.250011 13.5599C-0.0399894 13.3699 -0.10999 13.1499 0.23001 13.0899C1.79001 12.7999 2.19001 14.8499 3.23001 15.1799C3.97001 15.4099 4.93001 15.3099 5.41001 15.0099C5.47001 14.3799 5.93001 13.8399 6.31001 13.5499C3.66001 13.2999 2.09001 12.3799 1.27001 10.9099L1.18001 10.7399L0.970012 10.2699L0.91001 10.0999C0.65001 9.34991 0.540011 8.49991 0.540011 7.53991C0.540011 5.83991 1.07001 5.19991 1.79001 4.29991C1.24001 2.36991 1.99001 1.03991 1.99001 1.03991C1.99001 1.03991 3.14001 0.799913 5.31001 2.34991C6.49001 1.84991 9.62001 1.80991 11.1 2.23991C12.01 1.63991 13.68 0.789913 14.35 1.02991C14.53 1.31991 14.92 2.16991 14.59 4.03991C14.82 4.44991 16 5.31991 16.01 7.77991C15.99 8.68991 15.9 9.45991 15.72 10.0999L15.62 10.4299C15.62 10.4299 15.56 10.5899 15.5 10.7399L15.43 10.9099C14.64 12.6299 13.03 13.2699 10.42 13.5399C11.27 14.0699 11.51 14.7299 11.51 16.5299C11.51 18.3299 11.49 18.5699 11.49 18.9799C11.49 19.3499 11.79 19.6099 12.05 19.8099C10.53 20.4099 6.29001 20.4099 4.73001 19.7999V19.7999Z\"></path>\n                                                </svg>\n                                            </a>\n                                        </cover-l>\n                                    </div>\n                                </center-l>\n                            </div>\n\n                            <div class=\"footer-social\">\n                                <center-l data-i=\"Center-var(--measure)falsefalse\">\n                                    <div>\n                                        <cover-l space=\"0\" minheight=\"100%;\" nopad=\"true\" centered=\"a\" data-i=\"Cover-a0100%;true\">\n\n                                            <a href=\"https://www.linkedin.com/company/bonsai-search/\">\n\n                                                <svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"currentColor\">\n                                                    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0.230003 4.65H3.13V14H0.230003V4.65ZM10.52 4.42C13.46 4.42 14 6.36 14 8.87V13.99H11.1V9.44C11.1 8.35 11.08 6.96 9.59 6.96C8.1 6.96 7.85 8.14 7.85 9.36V13.99H4.95V4.65H7.72V5.93H7.76C8.15 5.19 9.09 4.42 10.51 4.42H10.52ZM1.68 0C2.61 0 3.36 0.76 3.36 1.69C3.36 2.62 2.6 3.38 1.68 3.38C0.76 3.38 0 2.62 0 1.69C0 0.76 0.75 0 1.68 0Z\"></path>\n                                                </svg>\n\n                                            </a>\n                                        </cover-l>\n                                    </div>\n                                </center-l>\n                            </div>\n                        </cluster-l>\n\n                        <!-- Trademarks -->\n\n                        <p>Elasticsearch is a trademark of\n                            Elasticsearch BV. Apache and Apache Lucene are\n                            trademarks of the <a href=\"https://www.apache.org/\">Apache\n                                Software\n                                Foundation</a>.</p>\n\n                        <!-- Legal links -->\n                        <cluster-l align=\"center\" space=\"var(--s-3);\" data-i=\"Cluster-flex-startcentervar(--s-3);\">\n                            <a href=\"https://status.bonsai.io/\">Status</a>\n                            <p>|</p>\n                            <a href=\"/faq\">FAQ</a>\n                            <p>|</p>\n                            <a href=\"/terms\">Terms</a>\n                            <p>|</p>\n                            <a href=\"/privacy\">Privacy</a>\n                        </cluster-l>\n                    </stack-l>\n\n                    <!-- Right/bottom grid layout for link sections -->\n                    <stack-l data-i=\"Stack-var(--s1)false\">\n                        <grid-l space=\"var(--s3);\" data-i=\"Grid-250pxvar(--s3);\">\n                            <!-- Resources column -->\n                            <stack-l data-i=\"Stack-var(--s1)false\">\n                                <p class=\"subhead\">Resources</p>\n                                <a href=\"/services/search-relevancy-assessment\">Search\n                                    Assessment</a>\n                                <a href=\"https://elements.heroku.com/addons/bonsai\">Heroku\n                                    Addon</a>\n                                <a href=\"/pricing\">Pricing</a>\n                                <a href=\"/docs\">Docs</a>\n                                <a href=\"/blog\">Blog</a>\n                                <a href=\"/announcements\">Announcements</a>\n                                <a href=\"/careers\">Careers</a>\n                                <a href=\"/contact\">Contact</a>\n                            </stack-l>\n\n                            <!-- Platform column -->\n                            <stack-l data-i=\"Stack-var(--s1)false\">\n                                <p class=\"subhead\">Platform</p>\n                                <a href=\"/platform/elasticsearch-on-google-cloud-platform\">Elasticsearch\n                                    on Google\n                                    Cloud</a>\n                                <a href=\"/platform/elasticsearch-on-aws\">Elasticsearch\n                                    on AWS</a>\n                                <a href=\"/platform/opensearch-on-google-cloud-platform\">OpenSearch\n                                    on Google\n                                    Cloud</a>\n                                <a href=\"/platform/opensearch-on-aws\">OpenSearch\n                                    on AWS</a>\n                            </stack-l>\n\n                            <!-- ES/OS-as-a-Service column -->\n                            <stack-l data-i=\"Stack-var(--s1)false\">\n                                <p class=\"subhead\">ES/OS-as-a-Service</p>\n                                <a href=\"/managed-elasticsearch\">Managed\n                                    Elasticsearch</a>\n                                <a href=\"/managed-opensearch\">Managed\n                                    OpenSearch</a>\n                            </stack-l>\n\n                            <!-- Comparison column - on smaller screens, this will wrap to a new row -->\n                            <stack-l data-i=\"Stack-var(--s1)false\">\n                                <p class=\"subhead\">Comparison</p>\n                                <a href=\"/vs/aiven\">Aiven vs\n                                    Bonsai</a>\n                                <a href=\"/vs/algolia\">Algolia\n                                    vs\n                                    Bonsai</a>\n                                <a href=\"/vs/amazon-opensearch-service\">Amazon\n                                    OpenSearch Service\n                                    vs\n                                    Bonsai</a>\n                                <a href=\"/vs/elastic-cloud\">Elastic\n                                    Cloud vs Bonsai</a>\n                                <a href=\"/vs/instaclustr\">Instaclustr\n                                    vs Bonsai</a>\n                            </stack-l>\n                        </grid-l>\n                    </stack-l>\n                </sidebar-l>\n\n                <!-- Copyright -->\n                <div class=\"copyright\">\n                    <p>© <span id=\"year\">2025</span> <a href=\"https://omc.io/\">One\n                            More\n                            Cloud, Inc.</a> All Rights Reserved</p>\n                </div>\n            </stack-l>\n        </div>\n    </center-l>\n</footer>\n\n<script>\n    document.getElementById('year').textContent = new Date().getFullYear();\n</script>\n\n\n\n\n</body></html>","error":null}},"type":"Object","created":"2025-06-14T17:41:12.730Z","ttl":0}